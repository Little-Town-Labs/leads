[{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\branding\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1131,1134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1131,1134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1972,1975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1972,1975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { auth } from '@clerk/nextjs/server';\r\nimport { db } from '@/db';\r\nimport { tenants } from '@/db/schema';\r\nimport { eq } from 'drizzle-orm';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function updateBranding(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const logoUrl = formData.get('logoUrl') as string || undefined;\r\n    const primaryColor = formData.get('primaryColor') as string;\r\n    const secondaryColor = formData.get('secondaryColor') as string;\r\n    const fontFamily = formData.get('fontFamily') as string || undefined;\r\n    const faviconUrl = formData.get('faviconUrl') as string || undefined;\r\n\r\n    await db\r\n      .update(tenants)\r\n      .set({\r\n        branding: {\r\n          logoUrl,\r\n          primaryColor,\r\n          secondaryColor,\r\n          fontFamily,\r\n          faviconUrl,\r\n        },\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(eq(tenants.clerkOrgId, orgId));\r\n\r\n    revalidatePath('/admin/branding');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error updating branding:', error);\r\n    return { error: error.message || 'Failed to update branding' };\r\n  }\r\n}\r\n\r\nexport async function updateLandingPage(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const heroTitle = formData.get('heroTitle') as string;\r\n    const heroSubtitle = formData.get('heroSubtitle') as string;\r\n    const ctaText = formData.get('ctaText') as string;\r\n\r\n    await db\r\n      .update(tenants)\r\n      .set({\r\n        landingPage: {\r\n          heroTitle,\r\n          heroSubtitle,\r\n          ctaText,\r\n        },\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(eq(tenants.clerkOrgId, orgId));\r\n\r\n    revalidatePath('/admin/branding');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error updating landing page:', error);\r\n    return { error: error.message || 'Failed to update landing page' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\branding\\branding-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\branding\\landing-page-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\branding\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\email\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1510,1513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1510,1513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { auth } from '@clerk/nextjs/server';\r\nimport { db } from '@/db';\r\nimport { tenants } from '@/db/schema';\r\nimport { eq } from 'drizzle-orm';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function updateEmailSettings(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const emailFromName = formData.get('emailFromName') as string || undefined;\r\n    const emailFromAddress = formData.get('emailFromAddress') as string || undefined;\r\n    const quizCompletionRedirect = formData.get('quizCompletionRedirect') as string || undefined;\r\n    const enableAiResearch = formData.get('enableAiResearch') === 'true';\r\n    const qualificationThreshold = parseInt(formData.get('qualificationThreshold') as string) || 60;\r\n\r\n    // Get current tenant settings\r\n    const tenant = await db.query.tenants.findFirst({\r\n      where: eq(tenants.clerkOrgId, orgId),\r\n    });\r\n\r\n    if (!tenant) {\r\n      return { error: 'Tenant not found' };\r\n    }\r\n\r\n    await db\r\n      .update(tenants)\r\n      .set({\r\n        settings: {\r\n          ...tenant.settings,\r\n          emailFromName,\r\n          emailFromAddress,\r\n          quizCompletionRedirect,\r\n          enableAiResearch,\r\n          qualificationThreshold,\r\n        },\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(eq(tenants.clerkOrgId, orgId));\r\n\r\n    revalidatePath('/admin/email');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error updating email settings:', error);\r\n    return { error: error.message || 'Failed to update email settings' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\email\\email-settings-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\email\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\knowledge-base\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1116,1119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1116,1119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1682,1685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1682,1685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2314,2317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2314,2317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { auth } from '@clerk/nextjs/server';\r\nimport { db } from '@/db';\r\nimport { knowledgeBaseDocs } from '@/db/schema';\r\nimport { eq, and } from 'drizzle-orm';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { addDocumentToKnowledgeBase } from '@/lib/knowledge-base';\r\n\r\nexport async function createKnowledgeBaseDoc(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const title = formData.get('title') as string;\r\n    const content = formData.get('content') as string;\r\n    const contentType = formData.get('contentType') as string;\r\n    const category = formData.get('category') as string || undefined;\r\n    const tags = formData.get('tags') ? (formData.get('tags') as string).split(',').map(t => t.trim()) : undefined;\r\n\r\n    // Add document with automatic chunking and embedding\r\n    await addDocumentToKnowledgeBase(orgId, title, content, contentType, {\r\n      category,\r\n      tags,\r\n    });\r\n\r\n    revalidatePath('/admin/knowledge-base');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error creating knowledge base document:', error);\r\n    return { error: error.message || 'Failed to create document' };\r\n  }\r\n}\r\n\r\nexport async function deleteKnowledgeBaseDoc(id: string) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    await db\r\n      .delete(knowledgeBaseDocs)\r\n      .where(and(eq(knowledgeBaseDocs.id, id), eq(knowledgeBaseDocs.orgId, orgId)));\r\n\r\n    revalidatePath('/admin/knowledge-base');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error deleting knowledge base document:', error);\r\n    return { error: error.message || 'Failed to delete document' };\r\n  }\r\n}\r\n\r\nexport async function toggleDocumentActive(id: string, isActive: boolean) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    await db\r\n      .update(knowledgeBaseDocs)\r\n      .set({ isActive, updatedAt: new Date() })\r\n      .where(and(eq(knowledgeBaseDocs.id, id), eq(knowledgeBaseDocs.orgId, orgId)));\r\n\r\n    revalidatePath('/admin/knowledge-base');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error toggling document:', error);\r\n    return { error: error.message || 'Failed to toggle document' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\knowledge-base\\add-document-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\knowledge-base\\knowledge-base-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2810,2813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2810,2813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2980,2983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2980,2983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { KnowledgeBaseDoc } from '@/db/schema';\r\nimport { FileText, Trash2, Eye, EyeOff } from 'lucide-react';\r\nimport { deleteKnowledgeBaseDoc, toggleDocumentActive } from './actions';\r\n\r\ntype KnowledgeBaseListProps = {\r\n  documents: KnowledgeBaseDoc[];\r\n};\r\n\r\nexport function KnowledgeBaseList({ documents }: KnowledgeBaseListProps) {\r\n  const [processingId, setProcessingId] = useState<string | null>(null);\r\n\r\n  const handleDelete = async (id: string, title: string) => {\r\n    if (!confirm(`Are you sure you want to delete \"${title}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    setProcessingId(id);\r\n    const result = await deleteKnowledgeBaseDoc(id);\r\n\r\n    if (result.error) {\r\n      alert(result.error);\r\n    }\r\n\r\n    setProcessingId(null);\r\n  };\r\n\r\n  const handleToggle = async (id: string, currentStatus: boolean) => {\r\n    setProcessingId(id);\r\n    const result = await toggleDocumentActive(id, !currentStatus);\r\n\r\n    if (result.error) {\r\n      alert(result.error);\r\n    }\r\n\r\n    setProcessingId(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\r\n      <ul className=\"divide-y divide-gray-200\">\r\n        {documents.map((doc) => (\r\n          <li key={doc.id} className=\"hover:bg-gray-50\">\r\n            <div className=\"px-4 py-4 sm:px-6\">\r\n              <div className=\"flex items-start justify-between\">\r\n                <div className=\"flex items-start gap-3 flex-1\">\r\n                  <FileText className=\"w-5 h-5 text-gray-400 mt-1\" />\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                      <h4 className=\"text-sm font-medium text-gray-900\">{doc.title}</h4>\r\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800\">\r\n                        {doc.contentType}\r\n                      </span>\r\n                      {!doc.isActive && (\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n                          Inactive\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    <p className=\"text-sm text-gray-600 line-clamp-2\">{doc.content.slice(0, 200)}...</p>\r\n                    <div className=\"mt-2 flex items-center gap-2 text-xs text-gray-500\">\r\n                      <span>\r\n                        {doc.content.length} characters\r\n                      </span>\r\n                      <span>•</span>\r\n                      <span>\r\n                        Added {new Date(doc.createdAt).toLocaleDateString()}\r\n                      </span>\r\n                      {doc.metadata && (doc.metadata as any).category && (\r\n                        <>\r\n                          <span>•</span>\r\n                          <span>\r\n                            {(doc.metadata as any).category}\r\n                          </span>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 ml-4\">\r\n                  <button\r\n                    onClick={() => handleToggle(doc.id, doc.isActive)}\r\n                    disabled={processingId === doc.id}\r\n                    className=\"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded disabled:opacity-50\"\r\n                    title={doc.isActive ? 'Deactivate' : 'Activate'}\r\n                  >\r\n                    {doc.isActive ? <Eye className=\"w-4 h-4\" /> : <EyeOff className=\"w-4 h-4\" />}\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handleDelete(doc.id, doc.title)}\r\n                    disabled={processingId === doc.id}\r\n                    className=\"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded disabled:opacity-50\"\r\n                    title=\"Delete\"\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\knowledge-base\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1480,1483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1480,1483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3027,3030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3027,3030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3562,3565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3562,3565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { auth } from '@clerk/nextjs/server';\r\nimport { db } from '@/db';\r\nimport { quizQuestions } from '@/db/schema';\r\nimport { eq, and } from 'drizzle-orm';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function createQuizQuestion(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const questionNumber = parseInt(formData.get('questionNumber') as string);\r\n    const questionType = formData.get('questionType') as string;\r\n    const questionText = formData.get('questionText') as string;\r\n    const questionSubtext = formData.get('questionSubtext') as string || null;\r\n    const placeholder = formData.get('placeholder') as string || null;\r\n    const scoringWeight = parseInt(formData.get('scoringWeight') as string) || 0;\r\n    const isRequired = formData.get('isRequired') === 'true';\r\n    const minSelections = formData.get('minSelections') ? parseInt(formData.get('minSelections') as string) : null;\r\n    const options = formData.get('options') ? JSON.parse(formData.get('options') as string) : null;\r\n\r\n    await db.insert(quizQuestions).values({\r\n      orgId,\r\n      questionNumber,\r\n      questionType,\r\n      questionText,\r\n      questionSubtext,\r\n      placeholder,\r\n      scoringWeight,\r\n      isRequired,\r\n      minSelections,\r\n      options,\r\n    });\r\n\r\n    revalidatePath('/admin/quiz');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error creating quiz question:', error);\r\n    return { error: error.message || 'Failed to create quiz question' };\r\n  }\r\n}\r\n\r\nexport async function updateQuizQuestion(id: string, formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const questionNumber = parseInt(formData.get('questionNumber') as string);\r\n    const questionType = formData.get('questionType') as string;\r\n    const questionText = formData.get('questionText') as string;\r\n    const questionSubtext = formData.get('questionSubtext') as string || null;\r\n    const placeholder = formData.get('placeholder') as string || null;\r\n    const scoringWeight = parseInt(formData.get('scoringWeight') as string) || 0;\r\n    const isRequired = formData.get('isRequired') === 'true';\r\n    const minSelections = formData.get('minSelections') ? parseInt(formData.get('minSelections') as string) : null;\r\n    const options = formData.get('options') ? JSON.parse(formData.get('options') as string) : null;\r\n\r\n    await db\r\n      .update(quizQuestions)\r\n      .set({\r\n        questionNumber,\r\n        questionType,\r\n        questionText,\r\n        questionSubtext,\r\n        placeholder,\r\n        scoringWeight,\r\n        isRequired,\r\n        minSelections,\r\n        options,\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(and(eq(quizQuestions.id, id), eq(quizQuestions.orgId, orgId)));\r\n\r\n    revalidatePath('/admin/quiz');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error updating quiz question:', error);\r\n    return { error: error.message || 'Failed to update quiz question' };\r\n  }\r\n}\r\n\r\nexport async function deleteQuizQuestion(id: string) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    await db\r\n      .delete(quizQuestions)\r\n      .where(and(eq(quizQuestions.id, id), eq(quizQuestions.orgId, orgId)));\r\n\r\n    revalidatePath('/admin/quiz');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error deleting quiz question:', error);\r\n    return { error: error.message || 'Failed to delete quiz question' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\add-question-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\edit-question-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\question-form-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\quiz\\quiz-question-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3495,3498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3495,3498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { QuizQuestion } from '@/db/schema';\r\nimport { Edit, Trash2, GripVertical } from 'lucide-react';\r\nimport { deleteQuizQuestion } from './actions';\r\nimport { EditQuestionModal } from './edit-question-modal';\r\n\r\ntype QuizQuestionListProps = {\r\n  questions: QuizQuestion[];\r\n};\r\n\r\nexport function QuizQuestionList({ questions }: QuizQuestionListProps) {\r\n  const [editingQuestion, setEditingQuestion] = useState<QuizQuestion | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\r\n\r\n  const handleDelete = async (id: string, questionText: string) => {\r\n    if (!confirm(`Are you sure you want to delete this question: \"${questionText}\"?`)) {\r\n      return;\r\n    }\r\n\r\n    setIsDeleting(id);\r\n    const result = await deleteQuizQuestion(id);\r\n\r\n    if (result.error) {\r\n      alert(result.error);\r\n    }\r\n\r\n    setIsDeleting(null);\r\n  };\r\n\r\n  const getQuestionTypeLabel = (type: string) => {\r\n    const labels: Record<string, string> = {\r\n      contact_info: 'Contact Info',\r\n      multiple_choice: 'Multiple Choice',\r\n      checkbox: 'Checkbox',\r\n      text: 'Text',\r\n    };\r\n    return labels[type] || type;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\r\n        <ul className=\"divide-y divide-gray-200\">\r\n          {questions.map((question) => (\r\n            <li key={question.id} className=\"hover:bg-gray-50\">\r\n              <div className=\"px-4 py-4 sm:px-6\">\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-start gap-3 flex-1\">\r\n                    <GripVertical className=\"w-5 h-5 text-gray-400 mt-1 cursor-move\" />\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800\">\r\n                          Q{question.questionNumber}\r\n                        </span>\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800\">\r\n                          {getQuestionTypeLabel(question.questionType)}\r\n                        </span>\r\n                        {question.isRequired && (\r\n                          <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800\">\r\n                            Required\r\n                          </span>\r\n                        )}\r\n                        {question.scoringWeight > 0 && (\r\n                          <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800\">\r\n                            Weight: {question.scoringWeight}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      <p className=\"text-sm font-medium text-gray-900\">\r\n                        {question.questionText}\r\n                      </p>\r\n                      {question.questionSubtext && (\r\n                        <p className=\"text-sm text-gray-500 mt-1\">{question.questionSubtext}</p>\r\n                      )}\r\n                      {question.options && Array.isArray(question.options) ? (\r\n                        <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                          {question.options.slice(0, 3).map((opt: any, idx: number) => (\r\n                            <span\r\n                              key={idx}\r\n                              className=\"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-50 text-gray-600 border border-gray-200\"\r\n                            >\r\n                              {opt.label || opt.value}\r\n                            </span>\r\n                          ))}\r\n                          {question.options.length > 3 && (\r\n                            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-50 text-gray-600\">\r\n                              +{question.options.length - 3} more\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      ) : null}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 ml-4\">\r\n                    <button\r\n                      onClick={() => setEditingQuestion(question)}\r\n                      className=\"p-2 text-blue-600 hover:text-blue-900 hover:bg-blue-50 rounded\"\r\n                      title=\"Edit question\"\r\n                    >\r\n                      <Edit className=\"w-4 h-4\" />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDelete(question.id, question.questionText)}\r\n                      disabled={isDeleting === question.id}\r\n                      className=\"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded disabled:opacity-50\"\r\n                      title=\"Delete question\"\r\n                    >\r\n                      <Trash2 className=\"w-4 h-4\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n\r\n      {editingQuestion && (\r\n        <EditQuestionModal\r\n          question={editingQuestion}\r\n          onClose={() => setEditingQuestion(null)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\admin\\workflows\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\analytics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalLeads' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getOrgDb } from '@/lib/db';\r\nimport { getUsageStats } from '@/lib/subscriptions';\r\nimport { auth } from '@clerk/nextjs/server';\r\nimport Link from 'next/link';\r\nimport { ArrowUpRight, Clock, CheckCircle2, XCircle, AlertCircle, Users } from 'lucide-react';\r\n\r\nexport default async function DashboardPage() {\r\n  const { orgId } = await auth();\r\n  const orgDb = await getOrgDb();\r\n\r\n  // Fetch data in parallel\r\n  const [leads, counts, usage] = await Promise.all([\r\n    orgDb.leads.findMany(),\r\n    orgDb.leads.countByStatus(),\r\n    getUsageStats(orgId!),\r\n  ]);\r\n\r\n  // Get recent leads (last 10)\r\n  const recentLeads = leads.slice(0, 10);\r\n\r\n  // Calculate stats\r\n  const totalLeads = counts.total;\r\n  const pendingLeads = counts.pending;\r\n  const approvedLeads = counts.approved;\r\n  const rejectedLeads = counts.rejected;\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Page Header */}\r\n      <div>\r\n        <h1 className=\"text-3xl font-bold text-gray-900\">Dashboard</h1>\r\n        <p className=\"mt-2 text-sm text-gray-700\">\r\n          Overview of your lead qualification pipeline\r\n        </p>\r\n      </div>\r\n\r\n      {/* Stats Grid */}\r\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4\">\r\n        {/* Usage Stats */}\r\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\r\n          <div className=\"p-5\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"flex-shrink-0\">\r\n                <AlertCircle className=\"h-6 w-6 text-blue-600\" />\r\n              </div>\r\n              <div className=\"ml-5 w-0 flex-1\">\r\n                <dl>\r\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">\r\n                    Monthly Usage\r\n                  </dt>\r\n                  <dd className=\"flex items-baseline\">\r\n                    <div className=\"text-2xl font-semibold text-gray-900\">\r\n                      {usage.usage}/{usage.limit}\r\n                    </div>\r\n                    <div className=\"ml-2 flex items-baseline text-sm font-semibold text-gray-500\">\r\n                      leads\r\n                    </div>\r\n                  </dd>\r\n                </dl>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-50 px-5 py-3\">\r\n            <div className=\"text-sm\">\r\n              <span className=\"font-medium text-gray-700\">\r\n                {Math.round((usage.usage / usage.limit) * 100)}% used\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Pending Leads */}\r\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\r\n          <div className=\"p-5\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"flex-shrink-0\">\r\n                <Clock className=\"h-6 w-6 text-yellow-600\" />\r\n              </div>\r\n              <div className=\"ml-5 w-0 flex-1\">\r\n                <dl>\r\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">\r\n                    Pending Review\r\n                  </dt>\r\n                  <dd className=\"flex items-baseline\">\r\n                    <div className=\"text-2xl font-semibold text-gray-900\">\r\n                      {pendingLeads}\r\n                    </div>\r\n                  </dd>\r\n                </dl>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-50 px-5 py-3\">\r\n            <Link\r\n              href=\"/leads?status=pending\"\r\n              className=\"text-sm font-medium text-blue-600 hover:text-blue-500 flex items-center\"\r\n            >\r\n              View pending\r\n              <ArrowUpRight className=\"ml-1 h-4 w-4\" />\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Approved Leads */}\r\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\r\n          <div className=\"p-5\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"flex-shrink-0\">\r\n                <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\r\n              </div>\r\n              <div className=\"ml-5 w-0 flex-1\">\r\n                <dl>\r\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">\r\n                    Approved\r\n                  </dt>\r\n                  <dd className=\"flex items-baseline\">\r\n                    <div className=\"text-2xl font-semibold text-gray-900\">\r\n                      {approvedLeads}\r\n                    </div>\r\n                  </dd>\r\n                </dl>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-50 px-5 py-3\">\r\n            <Link\r\n              href=\"/leads?status=approved\"\r\n              className=\"text-sm font-medium text-blue-600 hover:text-blue-500 flex items-center\"\r\n            >\r\n              View approved\r\n              <ArrowUpRight className=\"ml-1 h-4 w-4\" />\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Rejected Leads */}\r\n        <div className=\"bg-white overflow-hidden shadow rounded-lg\">\r\n          <div className=\"p-5\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"flex-shrink-0\">\r\n                <XCircle className=\"h-6 w-6 text-red-600\" />\r\n              </div>\r\n              <div className=\"ml-5 w-0 flex-1\">\r\n                <dl>\r\n                  <dt className=\"text-sm font-medium text-gray-500 truncate\">\r\n                    Rejected\r\n                  </dt>\r\n                  <dd className=\"flex items-baseline\">\r\n                    <div className=\"text-2xl font-semibold text-gray-900\">\r\n                      {rejectedLeads}\r\n                    </div>\r\n                  </dd>\r\n                </dl>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-50 px-5 py-3\">\r\n            <Link\r\n              href=\"/leads?status=rejected\"\r\n              className=\"text-sm font-medium text-blue-600 hover:text-blue-500 flex items-center\"\r\n            >\r\n              View rejected\r\n              <ArrowUpRight className=\"ml-1 h-4 w-4\" />\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Recent Leads Table */}\r\n      <div className=\"bg-white shadow rounded-lg\">\r\n        <div className=\"px-4 py-5 sm:p-6\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-lg font-medium text-gray-900\">Recent Leads</h2>\r\n            <Link\r\n              href=\"/leads\"\r\n              className=\"text-sm font-medium text-blue-600 hover:text-blue-500\"\r\n            >\r\n              View all\r\n            </Link>\r\n          </div>\r\n\r\n          {recentLeads.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <Users className=\"mx-auto h-12 w-12 text-gray-400\" />\r\n              <h3 className=\"mt-2 text-sm font-medium text-gray-900\">No leads yet</h3>\r\n              <p className=\"mt-1 text-sm text-gray-500\">\r\n                Get started by submitting your first lead through the form.\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead>\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Name\r\n                    </th>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Email\r\n                    </th>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Company\r\n                    </th>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Status\r\n                    </th>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Date\r\n                    </th>\r\n                    <th className=\"px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Action\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {recentLeads.map((lead) => (\r\n                    <tr key={lead.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                        {lead.name}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {lead.email}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {lead.company || '-'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <span\r\n                          className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                            lead.status === 'pending'\r\n                              ? 'bg-yellow-100 text-yellow-800'\r\n                              : lead.status === 'approved'\r\n                              ? 'bg-green-100 text-green-800'\r\n                              : 'bg-red-100 text-red-800'\r\n                          }`}\r\n                        >\r\n                          {lead.status}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {new Date(lead.createdAt).toLocaleDateString()}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                        <Link\r\n                          href={`/leads/${lead.id}`}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          View\r\n                        </Link>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\leads\\[id]\\approve-reject-buttons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\leads\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getOrgDb } from '@/lib/db';\r\nimport { hasPermission } from '@/lib/permissions';\r\nimport { notFound } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { ArrowLeft, Mail, Phone, Building2, Calendar, User } from 'lucide-react';\r\nimport { ApproveRejectButtons } from './approve-reject-buttons';\r\n\r\nexport default async function LeadDetailPage({\r\n  params,\r\n}: {\r\n  params: { id: string };\r\n}) {\r\n  const orgDb = await getOrgDb();\r\n  const canApprove = await hasPermission('leads:approve');\r\n\r\n  // Fetch lead\r\n  const lead = await orgDb.leads.findById(params.id);\r\n\r\n  if (!lead) {\r\n    notFound();\r\n  }\r\n\r\n  // Fetch workflows for this lead\r\n  const workflows = await orgDb.workflows.findByLeadId(lead.id);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Back Button */}\r\n      <Link\r\n        href=\"/leads\"\r\n        className=\"inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700\"\r\n      >\r\n        <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n        Back to leads\r\n      </Link>\r\n\r\n      {/* Header */}\r\n      <div className=\"bg-white shadow rounded-lg p-6\">\r\n        <div className=\"sm:flex sm:items-center sm:justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">{lead.name}</h1>\r\n            <div className=\"mt-2 flex items-center space-x-4\">\r\n              <span\r\n                className={`inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium ${\r\n                  lead.status === 'pending'\r\n                    ? 'bg-yellow-100 text-yellow-800'\r\n                    : lead.status === 'approved'\r\n                    ? 'bg-green-100 text-green-800'\r\n                    : 'bg-red-100 text-red-800'\r\n                }`}\r\n              >\r\n                {lead.status}\r\n              </span>\r\n              {lead.qualificationCategory && (\r\n                <span\r\n                  className={`inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium ${\r\n                    lead.qualificationCategory === 'QUALIFIED'\r\n                      ? 'bg-green-100 text-green-800'\r\n                      : lead.qualificationCategory === 'FOLLOW_UP'\r\n                      ? 'bg-blue-100 text-blue-800'\r\n                      : lead.qualificationCategory === 'SUPPORT'\r\n                      ? 'bg-purple-100 text-purple-800'\r\n                      : 'bg-gray-100 text-gray-800'\r\n                  }`}\r\n                >\r\n                  {lead.qualificationCategory}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n          {canApprove && lead.status === 'pending' && (\r\n            <div className=\"mt-4 sm:mt-0\">\r\n              <ApproveRejectButtons leadId={lead.id} />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\r\n        {/* Main Content */}\r\n        <div className=\"lg:col-span-2 space-y-6\">\r\n          {/* Contact Information */}\r\n          <div className=\"bg-white shadow rounded-lg p-6\">\r\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n              Contact Information\r\n            </h2>\r\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2\">\r\n              <div className=\"flex items-start\">\r\n                <Mail className=\"h-5 w-5 text-gray-400 mr-3 mt-0.5\" />\r\n                <div>\r\n                  <dt className=\"text-sm font-medium text-gray-500\">Email</dt>\r\n                  <dd className=\"mt-1 text-sm text-gray-900\">\r\n                    <a\r\n                      href={`mailto:${lead.email}`}\r\n                      className=\"text-blue-600 hover:text-blue-800\"\r\n                    >\r\n                      {lead.email}\r\n                    </a>\r\n                  </dd>\r\n                </div>\r\n              </div>\r\n\r\n              {lead.phone && (\r\n                <div className=\"flex items-start\">\r\n                  <Phone className=\"h-5 w-5 text-gray-400 mr-3 mt-0.5\" />\r\n                  <div>\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Phone</dt>\r\n                    <dd className=\"mt-1 text-sm text-gray-900\">\r\n                      <a\r\n                        href={`tel:${lead.phone}`}\r\n                        className=\"text-blue-600 hover:text-blue-800\"\r\n                      >\r\n                        {lead.phone}\r\n                      </a>\r\n                    </dd>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {lead.company && (\r\n                <div className=\"flex items-start\">\r\n                  <Building2 className=\"h-5 w-5 text-gray-400 mr-3 mt-0.5\" />\r\n                  <div>\r\n                    <dt className=\"text-sm font-medium text-gray-500\">Company</dt>\r\n                    <dd className=\"mt-1 text-sm text-gray-900\">{lead.company}</dd>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex items-start\">\r\n                <Calendar className=\"h-5 w-5 text-gray-400 mr-3 mt-0.5\" />\r\n                <div>\r\n                  <dt className=\"text-sm font-medium text-gray-500\">Submitted</dt>\r\n                  <dd className=\"mt-1 text-sm text-gray-900\">\r\n                    {new Date(lead.createdAt).toLocaleDateString('en-US', {\r\n                      year: 'numeric',\r\n                      month: 'long',\r\n                      day: 'numeric',\r\n                    })}\r\n                  </dd>\r\n                </div>\r\n              </div>\r\n            </dl>\r\n          </div>\r\n\r\n          {/* Message */}\r\n          {lead.message && (\r\n            <div className=\"bg-white shadow rounded-lg p-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Message</h2>\r\n              <p className=\"text-sm text-gray-700 whitespace-pre-wrap\">{lead.message}</p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Qualification Details */}\r\n          {lead.qualificationReason && (\r\n            <div className=\"bg-white shadow rounded-lg p-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n                Qualification Analysis\r\n              </h2>\r\n              <div className=\"prose prose-sm max-w-none\">\r\n                <p className=\"text-sm text-gray-700\">{lead.qualificationReason}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Email Draft */}\r\n          {lead.emailDraft && (\r\n            <div className=\"bg-white shadow rounded-lg p-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n                Email Draft\r\n              </h2>\r\n              <div className=\"bg-gray-50 rounded-md p-4\">\r\n                <p className=\"text-sm text-gray-700 whitespace-pre-wrap\">\r\n                  {lead.emailDraft}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Sidebar */}\r\n        <div className=\"space-y-6\">\r\n          {/* Research Results */}\r\n          {lead.researchResults != null && (\r\n            <div className=\"bg-white shadow rounded-lg p-6\">\r\n              <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n                Research Results\r\n              </h2>\r\n              <div className=\"text-sm text-gray-700\">\r\n                <p className=\"line-clamp-6\">\r\n                  {typeof lead.researchResults === 'string'\r\n                    ? lead.researchResults\r\n                    : JSON.stringify(lead.researchResults)}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Workflow History */}\r\n          <div className=\"bg-white shadow rounded-lg p-6\">\r\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n              Workflow History\r\n            </h2>\r\n            {workflows.length === 0 ? (\r\n              <p className=\"text-sm text-gray-500\">No workflow history yet</p>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {workflows.map((workflow) => (\r\n                  <div key={workflow.id} className=\"border-l-2 border-gray-200 pl-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span\r\n                        className={`text-xs font-medium ${\r\n                          workflow.status === 'completed'\r\n                            ? 'text-green-600'\r\n                            : workflow.status === 'failed'\r\n                            ? 'text-red-600'\r\n                            : 'text-yellow-600'\r\n                        }`}\r\n                      >\r\n                        {workflow.status}\r\n                      </span>\r\n                      <span className=\"text-xs text-gray-500\">\r\n                        {new Date(workflow.createdAt).toLocaleDateString()}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"mt-1 text-sm text-gray-700\">Workflow {workflow.id.slice(0, 8)}</p>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Metadata */}\r\n          <div className=\"bg-white shadow rounded-lg p-6\">\r\n            <h2 className=\"text-lg font-medium text-gray-900 mb-4\">Details</h2>\r\n            <dl className=\"space-y-3\">\r\n              <div>\r\n                <dt className=\"text-sm font-medium text-gray-500\">Lead ID</dt>\r\n                <dd className=\"mt-1 text-sm text-gray-900 font-mono text-xs\">\r\n                  {lead.id}\r\n                </dd>\r\n              </div>\r\n              <div>\r\n                <dt className=\"text-sm font-medium text-gray-500\">Created</dt>\r\n                <dd className=\"mt-1 text-sm text-gray-900\">\r\n                  {new Date(lead.createdAt).toLocaleString()}\r\n                </dd>\r\n              </div>\r\n              <div>\r\n                <dt className=\"text-sm font-medium text-gray-500\">Updated</dt>\r\n                <dd className=\"mt-1 text-sm text-gray-900\">\r\n                  {new Date(lead.updatedAt).toLocaleString()}\r\n                </dd>\r\n              </div>\r\n            </dl>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\leads\\leads-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\leads\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getOrgDb } from '@/lib/db';\r\nimport { hasPermission } from '@/lib/permissions';\r\nimport Link from 'next/link';\r\nimport { Download, Search } from 'lucide-react';\r\nimport { LeadsTable } from './leads-table';\r\n\r\nexport default async function LeadsPage({\r\n  searchParams,\r\n}: {\r\n  searchParams: { status?: string; search?: string };\r\n}) {\r\n  const orgDb = await getOrgDb();\r\n  const canExport = await hasPermission('leads:export');\r\n\r\n  // Fetch leads based on filters\r\n  let leads = await orgDb.leads.findMany();\r\n\r\n  // Filter by status if provided\r\n  if (searchParams.status) {\r\n    leads = leads.filter((lead) => lead.status === searchParams.status);\r\n  }\r\n\r\n  // Filter by search query if provided\r\n  if (searchParams.search) {\r\n    const query = searchParams.search.toLowerCase();\r\n    leads = leads.filter(\r\n      (lead) =>\r\n        lead.name.toLowerCase().includes(query) ||\r\n        lead.email.toLowerCase().includes(query) ||\r\n        lead.company?.toLowerCase().includes(query)\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Page Header */}\r\n      <div className=\"sm:flex sm:items-center sm:justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Leads</h1>\r\n          <p className=\"mt-2 text-sm text-gray-700\">\r\n            Manage and review all your qualified leads\r\n          </p>\r\n        </div>\r\n        {canExport && (\r\n          <div className=\"mt-4 sm:mt-0\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n            >\r\n              <Download className=\"mr-2 h-4 w-4\" />\r\n              Export\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white shadow rounded-lg p-4\">\r\n        <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\r\n          {/* Search */}\r\n          <div>\r\n            <label htmlFor=\"search\" className=\"sr-only\">\r\n              Search\r\n            </label>\r\n            <div className=\"relative\">\r\n              <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n                <Search className=\"h-5 w-5 text-gray-400\" />\r\n              </div>\r\n              <input\r\n                type=\"text\"\r\n                name=\"search\"\r\n                id=\"search\"\r\n                className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                placeholder=\"Search by name, email, or company...\"\r\n                defaultValue={searchParams.search}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Status Filter */}\r\n          <div>\r\n            <label htmlFor=\"status\" className=\"sr-only\">\r\n              Status\r\n            </label>\r\n            <select\r\n              id=\"status\"\r\n              name=\"status\"\r\n              className=\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md\"\r\n              defaultValue={searchParams.status || ''}\r\n            >\r\n              <option value=\"\">All Statuses</option>\r\n              <option value=\"pending\">Pending</option>\r\n              <option value=\"approved\">Approved</option>\r\n              <option value=\"rejected\">Rejected</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Leads Table */}\r\n      <div className=\"bg-white shadow rounded-lg\">\r\n        <LeadsTable leads={leads} />\r\n      </div>\r\n\r\n      {/* Pagination (if needed) */}\r\n      {leads.length > 50 && (\r\n        <div className=\"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-lg shadow\">\r\n          <div className=\"flex-1 flex justify-between sm:hidden\">\r\n            <button className=\"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\">\r\n              Previous\r\n            </button>\r\n            <button className=\"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\">\r\n              Next\r\n            </button>\r\n          </div>\r\n          <div className=\"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-700\">\r\n                Showing <span className=\"font-medium\">1</span> to{' '}\r\n                <span className=\"font-medium\">{Math.min(50, leads.length)}</span> of{' '}\r\n                <span className=\"font-medium\">{leads.length}</span> results\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <nav className=\"relative z-0 inline-flex rounded-md shadow-sm -space-x-px\">\r\n                <button className=\"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\r\n                  Previous\r\n                </button>\r\n                <button className=\"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50\">\r\n                  1\r\n                </button>\r\n                <button className=\"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50\">\r\n                  Next\r\n                </button>\r\n              </nav>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\settings\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[913,916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[913,916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1618,1621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1618,1621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2410,2413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2410,2413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { auth, clerkClient } from '@clerk/nextjs/server';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n/**\r\n * Invite a member to the organization via email\r\n */\r\nexport async function inviteMember(formData: FormData) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  const email = formData.get('email') as string;\r\n  const role = (formData.get('role') as string) || 'org:member';\r\n\r\n  if (!email) {\r\n    return { error: 'Email is required' };\r\n  }\r\n\r\n  try {\r\n    const client = await clerkClient();\r\n\r\n    // Create an invitation\r\n    const invitation = await client.organizations.createOrganizationInvitation({\r\n      organizationId: orgId,\r\n      emailAddress: email,\r\n      role: role as 'org:admin' | 'org:member',\r\n    });\r\n\r\n    revalidatePath('/settings');\r\n    return { success: true, invitation };\r\n  } catch (error: any) {\r\n    console.error('Error inviting member:', error);\r\n    return { error: error.message || 'Failed to invite member' };\r\n  }\r\n}\r\n\r\n/**\r\n * Update a member's role in the organization\r\n */\r\nexport async function updateMemberRole(membershipId: string, newRole: string) {\r\n  const { orgId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  try {\r\n    const client = await clerkClient();\r\n\r\n    await client.organizations.updateOrganizationMembership({\r\n      organizationId: orgId,\r\n      userId: membershipId,\r\n      role: newRole as 'org:admin' | 'org:member',\r\n    });\r\n\r\n    revalidatePath('/settings');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error updating member role:', error);\r\n    return { error: error.message || 'Failed to update member role' };\r\n  }\r\n}\r\n\r\n/**\r\n * Remove a member from the organization\r\n */\r\nexport async function removeMember(userId: string) {\r\n  const { orgId, userId: currentUserId } = await auth();\r\n\r\n  if (!orgId) {\r\n    return { error: 'No organization found' };\r\n  }\r\n\r\n  // Prevent self-removal\r\n  if (userId === currentUserId) {\r\n    return { error: 'You cannot remove yourself from the organization' };\r\n  }\r\n\r\n  try {\r\n    const client = await clerkClient();\r\n\r\n    await client.organizations.deleteOrganizationMembership({\r\n      organizationId: orgId,\r\n      userId: userId,\r\n    });\r\n\r\n    revalidatePath('/settings');\r\n    return { success: true };\r\n  } catch (error: any) {\r\n    console.error('Error removing member:', error);\r\n    return { error: error.message || 'Failed to remove member' };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\settings\\invite-member-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\settings\\manage-member-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\(dashboard)\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\.well-known\\workflow\\v1\\flow\\route.js","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":2,"column":1,"severity":1,"nodeType":null,"fix":{"range":[41,61],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// biome-ignore-all lint: generated file\n/* eslint-disable */\nimport { workflowEntrypoint } from 'workflow/runtime';\n\nconst workflowCode = `// virtual-entry.js\nglobalThis.__private_workflows = /* @__PURE__ */ new Map();\n`;\n\nexport const POST = workflowEntrypoint(workflowCode);","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\.well-known\\workflow\\v1\\step\\route.js","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":2,"column":1,"severity":1,"nodeType":null,"fix":{"range":[41,61],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// biome-ignore-all lint: generated file\n/* eslint-disable */\n\nvar __defProp = Object.defineProperty;\nvar __name = (target, value) => __defProp(target, \"name\", { value, configurable: true });\n\n// node_modules/.pnpm/workflow@4.0.1-beta.1_@aws-_5e07e9440d11460f736e6ef5365393d6/node_modules/workflow/dist/internal/builtins.js\nimport { registerStepFunction } from \"workflow/internal/private\";\nasync function __builtin_response_array_buffer(res) {\n  return res.arrayBuffer();\n}\n__name(__builtin_response_array_buffer, \"__builtin_response_array_buffer\");\nasync function __builtin_response_json(res) {\n  return res.json();\n}\n__name(__builtin_response_json, \"__builtin_response_json\");\nasync function __builtin_response_text(res) {\n  return res.text();\n}\n__name(__builtin_response_text, \"__builtin_response_text\");\nregisterStepFunction(\"__builtin_response_array_buffer\", __builtin_response_array_buffer);\nregisterStepFunction(\"__builtin_response_json\", __builtin_response_json);\nregisterStepFunction(\"__builtin_response_text\", __builtin_response_text);\n\n// virtual-entry.js\nimport { stepEntrypoint } from \"workflow/runtime\";\nexport {\n  stepEntrypoint as POST\n};\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\.well-known\\workflow\\v1\\webhook\\[token]\\route.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\[tenant]\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\[tenant]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link';\nimport { notFound } from 'next/navigation';\nimport { getTenantBySubdomain } from '@/lib/tenants';\nimport { ArrowRight, CheckCircle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\n/**\n * Tenant Landing Page\n * Dynamically rendered based on tenant configuration\n *\n * Examples:\n * - lead-agent.leadagent.com -> Lead Agent Demo landing page\n * - timeless-tech.leadagent.com -> Timeless Tech DDIP landing page\n */\nexport default async function TenantLandingPage({\n  params,\n}: {\n  params: Promise<{ tenant: string }>;\n}) {\n  const { tenant: tenantSlug } = await params;\n  const tenant = await getTenantBySubdomain(tenantSlug);\n\n  if (!tenant) {\n    notFound();\n  }\n\n  const { landingPage, branding, name } = tenant;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n      {/* Header/Navigation */}\n      <header className=\"border-b border-border bg-white/80 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            {branding.logoUrl && (\n              <img\n                src={branding.logoUrl}\n                alt={`${name} logo`}\n                className=\"h-8 w-auto\"\n              />\n            )}\n            <div\n              className=\"text-xl font-bold\"\n              style={{ color: branding.primaryColor }}\n            >\n              {name}\n            </div>\n          </div>\n          <nav className=\"hidden md:flex items-center gap-6 text-sm\">\n            <a\n              href=\"#features\"\n              className=\"text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              Features\n            </a>\n            <a\n              href=\"#how-it-works\"\n              className=\"text-muted-foreground hover:text-foreground transition-colors\"\n            >\n              How It Works\n            </a>\n            <Link\n              href={`/${tenantSlug}/quiz`}\n              className=\"px-4 py-2 rounded-md hover:opacity-90 transition-colors text-white\"\n              style={{ backgroundColor: branding.primaryColor }}\n            >\n              Get Started\n            </Link>\n          </nav>\n        </div>\n      </header>\n\n      <main>\n        {/* Hero Section */}\n        <section className=\"container mx-auto px-4 py-16 md:py-24\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            {/* Main Headline */}\n            <h1 className=\"text-4xl md:text-6xl font-bold text-foreground mb-6 leading-tight\">\n              {landingPage.heroTitle}\n            </h1>\n\n            {/* Subheadline */}\n            <p className=\"text-xl md:text-2xl text-muted-foreground mb-8 leading-relaxed\">\n              {landingPage.heroSubtitle}\n            </p>\n\n            {/* CTA Button */}\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center mb-12\">\n              <Link\n                href={`/${tenantSlug}/quiz`}\n                className=\"group inline-flex items-center gap-2 px-8 py-4 text-lg font-semibold text-white rounded-lg hover:opacity-90 transition-all shadow-lg hover:shadow-xl\"\n                style={{ backgroundColor: branding.primaryColor }}\n              >\n                {landingPage.ctaText}\n                <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n              </Link>\n            </div>\n\n            {/* Trust Indicators */}\n            <div className=\"flex flex-wrap justify-center items-center gap-6 text-sm text-muted-foreground pt-8 border-t border-border\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"w-4 h-4\" style={{ color: branding.primaryColor }} />\n                <span>No credit card required</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle className=\"w-4 h-4\" style={{ color: branding.primaryColor }} />\n                <span>Takes 4-5 minutes</span>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Features Section */}\n        {landingPage.featureSections && landingPage.featureSections.length > 0 && (\n          <section id=\"features\" className=\"container mx-auto px-4 py-16 bg-muted/30\">\n            <div className=\"max-w-5xl mx-auto\">\n              <h2 className=\"text-3xl md:text-4xl font-bold text-foreground mb-12 text-center\">\n                What You'll Discover\n              </h2>\n\n              <div className=\"grid md:grid-cols-2 gap-8\">\n                {landingPage.featureSections.map((feature, index) => (\n                  <div key={index} className=\"flex gap-4\">\n                    <div className=\"flex-shrink-0\">\n                      <div\n                        className=\"w-12 h-12 rounded-lg flex items-center justify-center border\"\n                        style={{\n                          backgroundColor: `${branding.primaryColor}10`,\n                          borderColor: `${branding.primaryColor}20`,\n                        }}\n                      >\n                        {/* Icon placeholder - you can map icon names to actual icons */}\n                        <span\n                          className=\"text-2xl\"\n                          style={{ color: branding.primaryColor }}\n                        >\n                          {feature.icon?.[0] || '✓'}\n                        </span>\n                      </div>\n                    </div>\n                    <div>\n                      <h3 className=\"text-xl font-bold text-foreground mb-2\">\n                        {feature.title}\n                      </h3>\n                      <p className=\"text-muted-foreground\">\n                        {feature.description}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </section>\n        )}\n\n        {/* Final CTA Section */}\n        <section className=\"container mx-auto px-4 py-16\">\n          <div\n            className=\"max-w-3xl mx-auto text-center rounded-2xl p-12\"\n            style={{\n              background: `linear-gradient(to right, ${branding.primaryColor}, ${branding.secondaryColor})`,\n            }}\n          >\n            <h2 className=\"text-3xl md:text-4xl font-bold text-white mb-4\">\n              Ready to Get Started?\n            </h2>\n            <p className=\"text-xl text-white/90 mb-8\">\n              Take the assessment to see your personalized results and recommendations.\n            </p>\n\n            <Link\n              href={`/${tenantSlug}/quiz`}\n              className=\"group inline-flex items-center gap-2 px-8 py-4 text-lg font-semibold bg-white rounded-lg hover:bg-slate-50 transition-all shadow-lg hover:shadow-xl\"\n              style={{ color: branding.primaryColor }}\n            >\n              {landingPage.ctaText}\n              <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform\" />\n            </Link>\n\n            <p className=\"text-sm text-white/80 mt-6\">\n              ✓ No credit card required  •  ✓ Results in 5 minutes  •  ✓ Personalized insights\n            </p>\n          </div>\n        </section>\n\n        {/* Footer */}\n        <footer className=\"container mx-auto px-4 py-8 border-t border-border\">\n          <div className=\"max-w-4xl mx-auto text-center text-sm text-muted-foreground\">\n            <p>\n              Powered by <strong className=\"text-foreground\">{name}</strong>\n            </p>\n          </div>\n        </footer>\n      </main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\[tenant]\\quiz\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\[tenant]\\quiz\\quiz-form-wrapper.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[456,459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[456,459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { QuizForm } from '@/components/quiz-form';\nimport { useRouter } from 'next/navigation';\nimport { QuizQuestion } from '@/lib/quiz-types';\n\ntype QuizFormWrapperProps = {\n  questions: QuizQuestion[];\n  tenantSlug: string;\n  primaryColor: string;\n};\n\nexport function QuizFormWrapper({ questions, tenantSlug, primaryColor }: QuizFormWrapperProps) {\n  const router = useRouter();\n\n  const handleComplete = async (responses: Record<string, any>) => {\n    // Submit quiz responses to the API\n    const response = await fetch(`/api/quiz/submit`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        tenantSlug,\n        responses,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Failed to submit quiz');\n    }\n\n    const result = await response.json();\n\n    // Redirect to results page with the lead ID\n    router.push(`/${tenantSlug}/quiz/results?leadId=${result.leadId}`);\n  };\n\n  return (\n    <QuizForm\n      questions={questions}\n      tenantSlug={tenantSlug}\n      primaryColor={primaryColor}\n      onComplete={handleComplete}\n    />\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\[tenant]\\quiz\\results\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\admin\\seed-sequences\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'results' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":249,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":249,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { db } from '@/db';\nimport { emailSequences } from '@/db/schema';\n\nconst DEFAULT_ORG_ID = 'default';\n\nconst EMAIL_SEQUENCES = [\n  // COLD LEAD NURTURE SEQUENCE\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 1,\n    delayDays: 0,\n    subject: 'Thanks for Your Help Desk Assessment - Building Your Foundation',\n    body: `Hi {{name}},\n\nThank you for completing the Help Desk Health Assessment for {{company}}!\n\nYour assessment shows you're in the early stages of help desk optimization. That's perfectly fine - every great help desk started somewhere!\n\n**Your Next Steps:**\n\n1. **Build Data History**: Our DDIP (Data-Driven Insights Platform) works best with 12-18 months of ticket data. Focus on collecting comprehensive data now.\n\n2. **Establish Best Practices**: We've attached a guide on help desk ticketing fundamentals and key metrics to track.\n\n3. **Prepare for Data-Driven Analysis**: Once you have solid data history, DDIP can identify hidden patterns and improvement opportunities you'd never spot manually.\n\n**Free Resource Included:**\n📋 Help Desk Best Practices Checklist\n📊 Essential Metrics Guide\n\nWe'll check back in a few months to see how you're progressing. In the meantime, feel free to reach out with any questions.\n\nBest regards,\nTimeless Technology Solutions\nhttps://timelesstechs.com/#contact`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 2,\n    delayDays: 30,\n    subject: 'Help Desk Metrics: What to Track & Why',\n    body: `Hi {{name}},\n\nHope your help desk at {{company}} is growing!\n\nWe wanted to share some insights on the metrics that matter most when you're building your help desk foundation:\n\n**Core Metrics to Track:**\n- First Response Time (FRT)\n- Resolution Time\n- Ticket Volume by Category\n- Customer Satisfaction (CSAT)\n- Repeat Ticket Rate\n\n**Why These Matter:**\nOnce you have 12+ months of this data, DDIP can analyze trends and reveal:\n- Which categories generate the most tickets (and why)\n- Root causes of recurring issues\n- Opportunities for process improvements\n- Potential cost savings from automation\n\n**Quick Question:** How many months of ticket data do you currently have? Reply to this email and let us know where you're at.\n\nBest,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 3,\n    delayDays: 90,\n    subject: 'Ready to Revisit Your Help Desk Assessment?',\n    body: `Hi {{name}},\n\nIt's been a few months since you completed our Help Desk Health Assessment.\n\nIf you've been building your ticket data history and establishing best practices, you might be ready for a deeper analysis now.\n\n**Has Anything Changed?**\n- Do you now have 12+ months of ticket data?\n- Has your ticket volume increased?\n- Are you tracking metrics consistently?\n- Do you have budget allocated for help desk improvement?\n\nIf yes to 2 or more, **retake the assessment** to see if you're ready for DDIP:\n👉 https://timelesstechs.com/assessment\n\nOr simply reply to schedule a quick 15-minute call to discuss where you're at.\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n\n  // WARM LEAD NURTURE SEQUENCE\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 1,\n    delayDays: 0,\n    subject: 'Your Help Desk Assessment Results - Next Steps for {{company}}',\n    body: `Hi {{name}},\n\nThank you for completing the Help Desk Health Assessment! Your score of {{score}}% shows that {{company}} has potential for significant improvement through data-driven insights.\n\n**What Your Score Means:**\nYour help desk shows promise, but timing or readiness may need development. You're in good company - many organizations at this stage see 20-30% efficiency gains once they implement DDIP.\n\n**Resources We're Sending You:**\n\n📊 **Case Study**: How a similar-sized help desk reduced ticket volume by 28% using DDIP\n🎯 **Guide**: \"5 Hidden Patterns in Your Help Desk Data\"\n📈 **Webinar Invite**: Live DDIP demonstration (next session in 2 weeks)\n\n**Common Questions We Get:**\n\nQ: \"What makes DDIP different from regular reporting?\"\nA: DDIP identifies ROOT CAUSES, not just symptoms. It connects data points across your entire operation to reveal why issues happen.\n\nQ: \"How much data do we need?\"\nA: Ideally 12-18 months of ticket history for meaningful pattern analysis.\n\nWant to discuss your specific situation? **Book a 20-minute call** here:\n👉 https://timelesstechs.com/#contact\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 2,\n    delayDays: 7,\n    subject: 'Case Study: 28% Ticket Reduction Using DDIP',\n    body: `Hi {{name}},\n\nFollowing up on your help desk assessment - I wanted to share a relevant case study.\n\n**The Challenge:**\nA mid-sized SaaS company (similar to {{company}}) had 800+ tickets/month but couldn't identify why certain issues kept recurring.\n\n**What DDIP Discovered:**\n- 31% of tickets were actually related to ONE root cause (unclear onboarding documentation)\n- 18% of \"different\" issues all traced back to a single software configuration\n- Peak ticket times correlated with specific product features\n\n**The Results:**\n- 28% reduction in monthly tickets within 90 days\n- 40% faster resolution times\n- $47K annual savings in support costs\n\n**Could This Work for You?**\n\nBased on your assessment, you might see similar patterns in your data. The key is having the right analysis approach.\n\n**FREE Workshop Invitation:**\nJoin our next \"DDIP Demonstration\" webinar to see live analysis of help desk data.\n📅 Next session: [Date TBD]\n🔗 Register here: [Link]\n\nNo pressure - just sharing resources that might help {{company}} improve efficiency.\n\nBest,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 3,\n    delayDays: 21,\n    subject: '5 Hidden Patterns in Your Help Desk Data',\n    body: `Hi {{name}},\n\nMost help desks track metrics like \"tickets per day\" or \"average resolution time,\" but the real insights are hiding in the patterns between data points.\n\n**5 Patterns DDIP Commonly Finds:**\n\n1. **The Onboarding Spike**: New user tickets cluster around specific features (fixable with better documentation)\n\n2. **The Silent Killer**: Low-priority tickets that consume 40% of team time when aggregated\n\n3. **The Hidden Dependency**: Tickets in one category actually caused by issues in another department\n\n4. **The Time Bomb**: Gradually increasing ticket types that signal bigger problems coming\n\n5. **The Knowledge Gap**: Same questions from different customers (opportunity for self-service)\n\n**Your Help Desk at {{company}}:**\nBased on your {{score}}% assessment score, you likely have at least 2-3 of these patterns happening right now.\n\n**Want to Find Out Which Ones?**\n\nWe can run a quick preliminary analysis on a sample of your ticket data (completely confidential). Takes about 30 minutes.\n\nInterested? **Reply to this email** or book time here:\n👉 https://timelesstechs.com/#contact\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 4,\n    delayDays: 45,\n    subject: 'Still Thinking About Help Desk Optimization?',\n    body: `Hi {{name}},\n\nJust checking in - I know help desk improvement might not be top priority right now for {{company}}.\n\n**No worries if timing isn't right yet.** But I wanted to leave you with one thought:\n\nEvery month you wait to implement data-driven insights is another month of:\n- Repeated issues that could be prevented\n- Team time spent on symptoms instead of root causes\n- Hidden costs you don't even know exist yet\n\n**When You're Ready:**\n\n✅ Retake the assessment if circumstances have changed\n✅ Book a strategy call to discuss timing\n✅ Join our email list for ongoing tips (no spam, promise)\n\nOr simply **reply \"not now\"** and I'll check back in 6 months.\n\nThanks for your time,\nTimeless Technology Solutions\n\nP.S. - Quick question: What would need to change for help desk optimization to become a priority? Budget? Team size? Management buy-in? Your answer helps us serve you better.`,\n    isActive: true,\n  },\n];\n\n/**\n * POST /api/admin/seed-sequences\n * Seeds email nurture sequences (admin only endpoint)\n */\nexport async function POST() {\n  try {\n    // Insert sequences (on conflict do nothing)\n    const results = await db.insert(emailSequences).values(EMAIL_SEQUENCES).onConflictDoNothing();\n\n    return NextResponse.json({\n      success: true,\n      message: 'Email sequences seeded successfully',\n      count: EMAIL_SEQUENCES.length,\n      sequences: {\n        cold: 3,\n        warm: 4,\n      },\n    });\n  } catch (error) {\n    console.error('Error seeding email sequences:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to seed email sequences',\n        details: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * GET /api/admin/seed-sequences\n * Returns current email sequences\n */\nexport async function GET() {\n  try {\n    const sequences = await db.query.emailSequences.findMany({\n      where: (emailSequences, { eq }) => eq(emailSequences.orgId, DEFAULT_ORG_ID),\n      orderBy: (emailSequences, { asc }) => [\n        asc(emailSequences.tier),\n        asc(emailSequences.sequenceNumber),\n      ],\n    });\n\n    return NextResponse.json({\n      success: true,\n      sequences,\n      count: sequences.length,\n    });\n  } catch (error) {\n    console.error('Error fetching email sequences:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to fetch email sequences',\n      },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\assessment\\questions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\assessment\\results\\[leadId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\assessment\\submit\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\dashboard\\approve\\[leadId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_ORG_ID' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/db';\nimport { leads, leadScores, workflows } from '@/db/schema';\nimport { eq, desc } from 'drizzle-orm';\n\nconst DEFAULT_ORG_ID = 'default';\nconst DEFAULT_USER_ID = 'system';\n\n/**\n * GET /api/dashboard/approve/[leadId]\n * Fetches approval data for a specific lead\n */\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ leadId: string }> }\n) {\n  try {\n    const { leadId } = await params;\n\n    // Fetch lead\n    const lead = await db.query.leads.findFirst({\n      where: eq(leads.id, leadId),\n    });\n\n    if (!lead) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Lead not found',\n        },\n        { status: 404 }\n      );\n    }\n\n    // Fetch score\n    const score = await db.query.leadScores.findFirst({\n      where: eq(leadScores.leadId, leadId),\n    });\n\n    // Fetch most recent workflow\n    const workflow = await db.query.workflows.findFirst({\n      where: eq(workflows.leadId, leadId),\n      orderBy: desc(workflows.createdAt),\n    });\n\n    if (!workflow || !workflow.emailDraft) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'No email draft available for this lead',\n        },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      lead: {\n        id: lead.id,\n        name: lead.name,\n        email: lead.email,\n        company: lead.company,\n        phone: lead.phone,\n        qualificationCategory: lead.qualificationCategory,\n        qualificationReason: lead.qualificationReason,\n        tier: score?.tier || 'unknown',\n        readinessScore: score?.readinessScore || 0,\n        createdAt: lead.createdAt,\n      },\n      workflow: {\n        id: workflow.id,\n        emailDraft: workflow.emailDraft,\n        researchResults: workflow.researchResults,\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching approval data:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to fetch approval data',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/dashboard/approve/[leadId]\n * Handles approve or reject actions for a lead\n */\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ leadId: string }> }\n) {\n  try {\n    const { leadId } = await params;\n    const body = await request.json();\n    const { action, emailDraft } = body;\n\n    if (!action || (action !== 'approve' && action !== 'reject')) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Invalid action. Must be \"approve\" or \"reject\"',\n        },\n        { status: 400 }\n      );\n    }\n\n    // Fetch lead to ensure it exists\n    const lead = await db.query.leads.findFirst({\n      where: eq(leads.id, leadId),\n    });\n\n    if (!lead) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Lead not found',\n        },\n        { status: 404 }\n      );\n    }\n\n    if (action === 'approve') {\n      if (!emailDraft || !emailDraft.trim()) {\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'Email draft is required for approval',\n          },\n          { status: 400 }\n        );\n      }\n\n      // Update lead status to approved and save the email draft\n      await db\n        .update(leads)\n        .set({\n          status: 'approved',\n          emailDraft: emailDraft,\n          updatedAt: new Date(),\n        })\n        .where(eq(leads.id, leadId));\n\n      // Update workflow to mark as approved\n      const workflow = await db.query.workflows.findFirst({\n        where: eq(workflows.leadId, leadId),\n        orderBy: desc(workflows.createdAt),\n      });\n\n      if (workflow) {\n        await db\n          .update(workflows)\n          .set({\n            approvedBy: DEFAULT_USER_ID,\n            emailDraft: emailDraft,\n          })\n          .where(eq(workflows.id, workflow.id));\n      }\n\n      return NextResponse.json({\n        success: true,\n        message: 'Lead approved successfully',\n        action: 'approved',\n      });\n    } else if (action === 'reject') {\n      // Update lead status to rejected\n      await db\n        .update(leads)\n        .set({\n          status: 'rejected',\n          updatedAt: new Date(),\n        })\n        .where(eq(leads.id, leadId));\n\n      // Update workflow to mark as rejected\n      const workflow = await db.query.workflows.findFirst({\n        where: eq(workflows.leadId, leadId),\n        orderBy: desc(workflows.createdAt),\n      });\n\n      if (workflow) {\n        await db\n          .update(workflows)\n          .set({\n            rejectedBy: DEFAULT_USER_ID,\n          })\n          .where(eq(workflows.id, workflow.id));\n      }\n\n      return NextResponse.json({\n        success: true,\n        message: 'Lead rejected successfully',\n        action: 'rejected',\n      });\n    }\n  } catch (error) {\n    console.error('Error processing approval action:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Failed to process action',\n      },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\dashboard\\leads\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\leads\\[id]\\approve\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\leads\\[id]\\reject\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\leads\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\leads\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'request' is defined but never used. Allowed unused args must match /^_/u.","line":9,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { getOrgDb } from '@/lib/db';\nimport { requirePermission } from '@/lib/permissions';\n\n/**\n * GET /api/leads\n * Get all leads for the current organization\n */\nexport async function GET(request: NextRequest) {\n  try {\n    await requirePermission('leads:view_all');\n\n    const orgDb = await getOrgDb();\n    const leads = await orgDb.leads.findMany();\n\n    return Response.json({ leads });\n  } catch (error) {\n    if (error instanceof Error && error.message.includes('Forbidden')) {\n      return Response.json({ error: error.message }, { status: 403 });\n    }\n    if (error instanceof Error && error.message.includes('No organization')) {\n      return Response.json({ error: error.message }, { status: 400 });\n    }\n    return Response.json({ error: 'Internal server error' }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\quiz\\submit\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'and' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/db';\nimport { leads, quizResponses, leadScores, quizQuestions } from '@/db/schema';\nimport { getTenantBySubdomain } from '@/lib/tenants';\nimport { checkBotId } from 'botid/server';\nimport { start } from 'workflow/api';\nimport { workflowInbound } from '@/workflows/inbound';\nimport { eq, and } from 'drizzle-orm';\nimport { z } from 'zod';\nimport { ContactInfo } from '@/lib/quiz-types';\n\n/**\n * Quiz Submission API Route\n * Handles tenant-aware quiz submissions\n * - Validates tenant\n * - Calculates scores\n * - Creates lead and saves responses\n * - Starts AI workflow\n */\n\nconst quizSubmissionSchema = z.object({\n  tenantSlug: z.string(),\n  responses: z.record(z.string(), z.any()),\n});\n\nexport async function POST(request: Request) {\n  try {\n    // Bot detection\n    const verification = await checkBotId();\n    if (verification.isBot) {\n      return Response.json({ error: 'Access denied' }, { status: 403 });\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const parsedBody = quizSubmissionSchema.safeParse(body);\n\n    if (!parsedBody.success) {\n      return Response.json({ error: 'Invalid request data', details: parsedBody.error }, { status: 400 });\n    }\n\n    const { tenantSlug, responses } = parsedBody.data;\n\n    // Get tenant configuration\n    const tenant = await getTenantBySubdomain(tenantSlug);\n    if (!tenant) {\n      return Response.json({ error: 'Tenant not found' }, { status: 404 });\n    }\n\n    // Get all quiz questions for this tenant\n    const questions = await db\n      .select()\n      .from(quizQuestions)\n      .where(eq(quizQuestions.orgId, tenant.clerkOrgId))\n      .orderBy(quizQuestions.questionNumber);\n\n    if (questions.length === 0) {\n      return Response.json({ error: 'No quiz questions found for this tenant' }, { status: 400 });\n    }\n\n    // Extract contact info from first question (should be contact_info type)\n    const contactQuestion = questions.find((q) => q.questionType === 'contact_info');\n    const contactInfo = (contactQuestion ? responses[contactQuestion.id] : {}) as ContactInfo;\n\n    if (!contactInfo.email || !contactInfo.full_name) {\n      return Response.json(\n        { error: 'Missing required contact information (email and name)' },\n        { status: 400 }\n      );\n    }\n\n    // Calculate total score\n    let totalPoints = 0;\n    let maxPossiblePoints = 0;\n\n    const scoreBreakdown: Record<string, { points: number; maxPoints: number }> = {};\n\n    for (const question of questions) {\n      const answer = responses[question.id];\n      let pointsEarned = 0;\n      const weight = question.scoringWeight || 0;\n\n      if (question.questionType === 'multiple_choice') {\n        // Find selected option and get its score\n        const options = question.options as Array<{ value: string; score?: number }>;\n        const selectedOption = options?.find((opt) => opt.value === answer);\n        if (selectedOption && selectedOption.score !== undefined) {\n          pointsEarned = selectedOption.score * weight;\n        }\n        // Max is highest score for this question\n        const maxScore = Math.max(...(options?.map((opt) => opt.score || 0) || [0]));\n        maxPossiblePoints += maxScore * weight;\n      } else if (question.questionType === 'checkbox') {\n        // Sum scores of selected options\n        const options = question.options as Array<{ value: string; score?: number }>;\n        if (Array.isArray(answer)) {\n          answer.forEach((val: string) => {\n            const option = options?.find((opt) => opt.value === val);\n            if (option && option.score !== undefined) {\n              pointsEarned += option.score * weight;\n            }\n          });\n        }\n        // Max is sum of all option scores\n        const maxScore = options?.reduce((sum, opt) => sum + (opt.score || 0), 0) || 0;\n        maxPossiblePoints += maxScore * weight;\n      }\n\n      totalPoints += pointsEarned;\n\n      // Track breakdown by question type\n      const category = question.questionType;\n      if (!scoreBreakdown[category]) {\n        scoreBreakdown[category] = { points: 0, maxPoints: 0 };\n      }\n      scoreBreakdown[category].points += pointsEarned;\n      scoreBreakdown[category].maxPoints += weight;\n    }\n\n    // Calculate readiness score (0-100)\n    const readinessScore =\n      maxPossiblePoints > 0 ? Math.round((totalPoints / maxPossiblePoints) * 100) : 0;\n\n    // Determine tier based on readiness score\n    let tier: 'cold' | 'warm' | 'hot' | 'qualified';\n    if (readinessScore >= 80) {\n      tier = 'qualified';\n    } else if (readinessScore >= 60) {\n      tier = 'hot';\n    } else if (readinessScore >= 40) {\n      tier = 'warm';\n    } else {\n      tier = 'cold';\n    }\n\n    // Create lead record\n    const [lead] = await db\n      .insert(leads)\n      .values({\n        orgId: tenant.clerkOrgId,\n        userId: 'quiz_submission', // Public quiz, no logged-in user\n        email: contactInfo.email,\n        name: contactInfo.full_name,\n        company: contactInfo.company || null,\n        phone: contactInfo.phone || null,\n        message: `Quiz submission - Readiness Score: ${readinessScore}% (${tier})`,\n        status: 'pending',\n      })\n      .returning();\n\n    // Save quiz responses\n    const responseRecords = questions.map((question) => {\n      const answer = responses[question.id];\n      let pointsEarned = 0;\n\n      // Calculate points for this specific response\n      if (question.questionType === 'multiple_choice') {\n        const options = question.options as Array<{ value: string; score?: number }>;\n        const selectedOption = options?.find((opt) => opt.value === answer);\n        if (selectedOption && selectedOption.score !== undefined) {\n          pointsEarned = selectedOption.score * (question.scoringWeight || 0);\n        }\n      } else if (question.questionType === 'checkbox' && Array.isArray(answer)) {\n        const options = question.options as Array<{ value: string; score?: number }>;\n        answer.forEach((val: string) => {\n          const option = options?.find((opt) => opt.value === val);\n          if (option && option.score !== undefined) {\n            pointsEarned += option.score * (question.scoringWeight || 0);\n          }\n        });\n      }\n\n      return {\n        orgId: tenant.clerkOrgId,\n        leadId: lead.id,\n        questionId: question.id,\n        questionNumber: question.questionNumber,\n        answer,\n        pointsEarned,\n      };\n    });\n\n    await db.insert(quizResponses).values(responseRecords);\n\n    // Save lead score\n    await db.insert(leadScores).values({\n      orgId: tenant.clerkOrgId,\n      leadId: lead.id,\n      readinessScore,\n      totalPoints,\n      maxPossiblePoints,\n      tier,\n      scoringBreakdown: scoreBreakdown,\n    });\n\n    // Start AI workflow if enabled\n    if (tenant.settings.enableAiResearch) {\n      await start(workflowInbound, [\n        {\n          ...lead,\n          tenantId: tenant.id,\n          tenantSettings: tenant.settings,\n        },\n      ]);\n    }\n\n    return Response.json(\n      {\n        message: 'Quiz submitted successfully',\n        leadId: lead.id,\n        readinessScore,\n        tier,\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Error submitting quiz:', error);\n    return Response.json(\n      { error: 'Failed to submit quiz', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\slack\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused args must match /^_/u.","line":10,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[772,775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[772,775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2024,2027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2024,2027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2076,2079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2076,2079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2738,2741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2738,2741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3564,3567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3564,3567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3616,3619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3616,3619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createHandler } from '@vercel/slack-bolt';\r\nimport { slackApp, receiver } from '@/lib/slack';\r\nimport { sendEmail } from '@/lib/services';\r\nimport { db } from '@/db';\r\nimport { workflows, leads } from '@/db/schema';\r\nimport { eq } from 'drizzle-orm';\r\n\r\n// Only set up event handlers if Slack is initialized\r\nif (slackApp && receiver) {\r\n  slackApp.event('app_mention', async ({ event, client, logger }) => {\r\n    await client.chat.postMessage({\r\n      channel: event.channel,\r\n      thread_ts: event.ts,\r\n      text: `Hello <@${event.user}>!`\r\n    });\r\n  });\r\n\r\n  slackApp.action(\r\n    'lead_approved',\r\n    async ({ body, action, ack, client, logger }) => {\r\n      await ack();\r\n\r\n      // Get workflow ID from button value\r\n      const workflowId = (action as any).value;\r\n\r\n      if (!workflowId) {\r\n        logger.error('No workflow ID provided in button action');\r\n        return;\r\n      }\r\n\r\n      // Update workflow status in database\r\n      await db.update(workflows).set({\r\n        status: 'completed',\r\n        approvedBy: body.user.id,\r\n        completedAt: new Date(),\r\n      }).where(eq(workflows.id, workflowId));\r\n\r\n      // Get workflow to find associated lead\r\n      const workflow = await db.query.workflows.findFirst({\r\n        where: eq(workflows.id, workflowId),\r\n      });\r\n\r\n      if (workflow?.leadId) {\r\n        // Update lead status\r\n        await db.update(leads).set({\r\n          status: 'approved',\r\n          updatedAt: new Date(),\r\n        }).where(eq(leads.id, workflow.leadId));\r\n\r\n        // Get lead details to send email\r\n        const lead = await db.query.leads.findFirst({\r\n          where: eq(leads.id, workflow.leadId),\r\n        });\r\n\r\n        // Send email to the lead\r\n        if (lead && workflow.emailDraft) {\r\n          await sendEmail(\r\n            lead.email,\r\n            `Re: Your inquiry from ${lead.company || 'your company'}`,\r\n            workflow.emailDraft\r\n          );\r\n        }\r\n      }\r\n\r\n      // Update Slack message\r\n      const channelId = (body as any).channel?.id;\r\n      const messageTs = (body as any).message?.ts;\r\n\r\n      if (channelId && messageTs) {\r\n        await client.chat.update({\r\n          channel: channelId,\r\n          ts: messageTs,\r\n          text: '✅ Lead approved',\r\n          blocks: [\r\n            {\r\n              type: 'section',\r\n              text: {\r\n                type: 'mrkdwn',\r\n                text: `✅ *Lead approved* by <@${body.user.id}>`,\r\n              },\r\n            },\r\n          ],\r\n        });\r\n      }\r\n    }\r\n  );\r\n\r\n  slackApp.action(\r\n    'lead_rejected',\r\n    async ({ body, action, ack, client, logger }) => {\r\n      await ack();\r\n\r\n      // Get workflow ID from button value\r\n      const workflowId = (action as any).value;\r\n\r\n      if (!workflowId) {\r\n        logger.error('No workflow ID provided in button action');\r\n        return;\r\n      }\r\n\r\n      // Update workflow status in database\r\n      await db.update(workflows).set({\r\n        status: 'completed',\r\n        rejectedBy: body.user.id,\r\n        completedAt: new Date(),\r\n      }).where(eq(workflows.id, workflowId));\r\n\r\n      // Get workflow to find associated lead\r\n      const workflow = await db.query.workflows.findFirst({\r\n        where: eq(workflows.id, workflowId),\r\n      });\r\n\r\n      if (workflow?.leadId) {\r\n        // Update lead status\r\n        await db.update(leads).set({\r\n          status: 'rejected',\r\n          updatedAt: new Date(),\r\n        }).where(eq(leads.id, workflow.leadId));\r\n      }\r\n\r\n      // Update Slack message\r\n      const channelId = (body as any).channel?.id;\r\n      const messageTs = (body as any).message?.ts;\r\n\r\n      if (channelId && messageTs) {\r\n        await client.chat.update({\r\n          channel: channelId,\r\n          ts: messageTs,\r\n          text: '❌ Lead rejected',\r\n          blocks: [\r\n            {\r\n              type: 'section',\r\n            text: {\r\n              type: 'mrkdwn',\r\n              text: `❌ *Lead rejected* by <@${body.user.id}>`,\r\n            },\r\n          },\r\n        ],\r\n        });\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nexport const POST =\r\n  slackApp && receiver\r\n    ? createHandler(slackApp, receiver)\r\n    : () =>\r\n        new Response('Slack credentials not configured', {\r\n          status: 503\r\n        });\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\submit\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\api\\webhooks\\clerk\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3741,3744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3741,3744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4179,4182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4179,4182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4545,4548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4545,4548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4864,4867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4864,4867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5654,5657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5654,5657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5954,5957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5954,5957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6328,6331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6328,6331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6687,6690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6687,6690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Webhook } from 'svix';\nimport { headers } from 'next/headers';\nimport { WebhookEvent } from '@clerk/nextjs/server';\nimport { db } from '@/db';\nimport { users, tenants, organizationMembers } from '@/db/schema';\nimport { eq, and } from 'drizzle-orm';\n\n/**\n * Clerk Webhook Handler\n *\n * Handles events from Clerk:\n * - user.created: Create user record in database\n * - user.updated: Update user information\n * - user.deleted: Remove user from database\n * - organization.created: Create organization/tenant\n * - organization.updated: Update organization info\n * - organization.deleted: Remove organization\n * - organizationMembership.created: Add user to org\n * - organizationMembership.deleted: Remove user from org\n *\n * To set up:\n * 1. Go to Clerk Dashboard → Webhooks\n * 2. Click \"Add Endpoint\"\n * 3. Enter your webhook URL: https://yourdomain.com/api/webhooks/clerk\n * 4. Select events to subscribe to\n * 5. Copy the signing secret and add to CLERK_WEBHOOK_SECRET env var\n */\nexport async function POST(req: Request) {\n  // Get the headers\n  const headerPayload = await headers();\n  const svix_id = headerPayload.get('svix-id');\n  const svix_timestamp = headerPayload.get('svix-timestamp');\n  const svix_signature = headerPayload.get('svix-signature');\n\n  // If there are no headers, error out\n  if (!svix_id || !svix_timestamp || !svix_signature) {\n    return new Response('Error: Missing svix headers', {\n      status: 400,\n    });\n  }\n\n  // Get the body\n  const payload = await req.json();\n  const body = JSON.stringify(payload);\n\n  // Get the webhook secret from environment\n  const WEBHOOK_SECRET = process.env.CLERK_WEBHOOK_SECRET;\n\n  if (!WEBHOOK_SECRET) {\n    console.error('Error: CLERK_WEBHOOK_SECRET is not set');\n    return new Response('Error: Webhook secret not configured', {\n      status: 500,\n    });\n  }\n\n  // Create a new Svix instance with your secret\n  const wh = new Webhook(WEBHOOK_SECRET);\n\n  let evt: WebhookEvent;\n\n  // Verify the webhook signature\n  try {\n    evt = wh.verify(body, {\n      'svix-id': svix_id,\n      'svix-timestamp': svix_timestamp,\n      'svix-signature': svix_signature,\n    }) as WebhookEvent;\n  } catch (err) {\n    console.error('Error: Webhook verification failed:', err);\n    return new Response('Error: Verification failed', {\n      status: 400,\n    });\n  }\n\n  // Handle the webhook\n  const eventType = evt.type;\n\n  console.log(`Webhook received: ${eventType}`, {\n    id: evt.data.id,\n  });\n\n  try {\n    switch (eventType) {\n      case 'user.created':\n        await handleUserCreated(evt.data);\n        break;\n\n      case 'user.updated':\n        await handleUserUpdated(evt.data);\n        break;\n\n      case 'user.deleted':\n        await handleUserDeleted(evt.data);\n        break;\n\n      case 'organization.created':\n        await handleOrganizationCreated(evt.data);\n        break;\n\n      case 'organization.updated':\n        await handleOrganizationUpdated(evt.data);\n        break;\n\n      case 'organization.deleted':\n        await handleOrganizationDeleted(evt.data);\n        break;\n\n      case 'organizationMembership.created':\n        await handleMembershipCreated(evt.data);\n        break;\n\n      case 'organizationMembership.deleted':\n        await handleMembershipDeleted(evt.data);\n        break;\n\n      default:\n        console.log(`Unhandled webhook event: ${eventType}`);\n    }\n\n    return new Response('Webhook processed successfully', { status: 200 });\n  } catch (error) {\n    console.error(`Error processing webhook ${eventType}:`, error);\n    return new Response('Error processing webhook', { status: 500 });\n  }\n}\n\n/**\n * Handler functions for each event type\n * TODO: Implement these based on your database schema\n */\n\nasync function handleUserCreated(data: any) {\n  console.log('User created:', {\n    id: data.id,\n    email: data.email_addresses?.[0]?.email_address,\n    firstName: data.first_name,\n    lastName: data.last_name,\n  });\n\n  await db.insert(users).values({\n    clerkUserId: data.id,\n    email: data.email_addresses?.[0]?.email_address || '',\n    firstName: data.first_name,\n    lastName: data.last_name,\n    imageUrl: data.image_url,\n  });\n}\n\nasync function handleUserUpdated(data: any) {\n  console.log('User updated:', data.id);\n\n  await db.update(users)\n    .set({\n      email: data.email_addresses?.[0]?.email_address || '',\n      firstName: data.first_name,\n      lastName: data.last_name,\n      imageUrl: data.image_url,\n      updatedAt: new Date(),\n    })\n    .where(eq(users.clerkUserId, data.id));\n}\n\nasync function handleUserDeleted(data: any) {\n  console.log('User deleted:', data.id);\n\n  // Delete user record and cascade to organization memberships\n  await db.delete(users).where(eq(users.clerkUserId, data.id));\n  await db.delete(organizationMembers).where(eq(organizationMembers.clerkUserId, data.id));\n}\n\nasync function handleOrganizationCreated(data: any) {\n  console.log('Organization created:', {\n    id: data.id,\n    name: data.name,\n    slug: data.slug,\n  });\n\n  await db.insert(tenants).values({\n    clerkOrgId: data.id,\n    name: data.name,\n    slug: data.slug,\n    subdomain: data.slug, // Use org slug as subdomain\n    branding: {\n      primaryColor: '#3B82F6',\n      secondaryColor: '#10B981',\n    },\n    landingPage: {\n      heroTitle: `Welcome to ${data.name}`,\n      heroSubtitle: 'Complete our assessment to get started',\n      ctaText: 'Take Assessment',\n    },\n    settings: {\n      enableAiResearch: true,\n      qualificationThreshold: 60,\n    },\n    usageLimits: {\n      maxQuizCompletionsMonthly: 100,\n      maxAiWorkflowsMonthly: 50,\n      maxTeamMembers: 5,\n    },\n  });\n}\n\nasync function handleOrganizationUpdated(data: any) {\n  console.log('Organization updated:', data.id);\n\n  await db.update(tenants)\n    .set({\n      name: data.name,\n      slug: data.slug,\n      subdomain: data.slug,\n      updatedAt: new Date(),\n    })\n    .where(eq(tenants.clerkOrgId, data.id));\n}\n\nasync function handleOrganizationDeleted(data: any) {\n  console.log('Organization deleted:', data.id);\n\n  // Delete tenant - this will cascade to delete org-specific data\n  await db.delete(tenants).where(eq(tenants.clerkOrgId, data.id));\n  // Also clean up organization memberships\n  await db.delete(organizationMembers).where(eq(organizationMembers.clerkOrgId, data.id));\n}\n\nasync function handleMembershipCreated(data: any) {\n  console.log('Membership created:', {\n    orgId: data.organization.id,\n    userId: data.public_user_data.user_id,\n    role: data.role,\n  });\n\n  await db.insert(organizationMembers).values({\n    clerkOrgId: data.organization.id,\n    clerkUserId: data.public_user_data.user_id,\n    role: data.role,\n  });\n}\n\nasync function handleMembershipDeleted(data: any) {\n  console.log('Membership deleted:', {\n    orgId: data.organization.id,\n    userId: data.public_user_data.user_id,\n  });\n\n  await db.delete(organizationMembers)\n    .where(and(\n      eq(organizationMembers.clerkOrgId, data.organization.id),\n      eq(organizationMembers.clerkUserId, data.public_user_data.user_id)\n    ));\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\assessment\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\assessment\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\assessment\\quiz\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[314,317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[314,317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[687,690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[687,690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":47,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2748,2751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2748,2751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2861,2864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2861,2864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":159,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5570,5573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5570,5573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5611,5614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5611,5614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":364,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12367,12370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12367,12370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":372,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12576,12579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12576,12579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13491,13494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13491,13494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":404,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":404,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13570,13573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13570,13573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":437,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14495,14498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14495,14498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":449,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14785,14788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14785,14788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { ArrowLeft, ArrowRight, CheckCircle, Loader2 } from 'lucide-react';\nimport type { QuizQuestion } from '@/db/schema';\n\ninterface QuizResponse {\n  questionId: string;\n  questionNumber: number;\n  answer: any;\n  pointsEarned: number;\n}\n\nexport default function QuizPage() {\n  const router = useRouter();\n  const [questions, setQuestions] = useState<QuizQuestion[]>([]);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [responses, setResponses] = useState<Map<number, QuizResponse>>(new Map());\n  const [currentAnswer, setCurrentAnswer] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch quiz questions on mount\n  useEffect(() => {\n    async function fetchQuestions() {\n      try {\n        const res = await fetch('/api/assessment/questions');\n        const data = await res.json();\n\n        if (data.success) {\n          setQuestions(data.questions);\n          // Load saved responses from localStorage\n          const saved = localStorage.getItem('quiz_responses');\n          if (saved) {\n            const savedResponses: Map<number, QuizResponse> = new Map(JSON.parse(saved));\n            setResponses(savedResponses);\n\n            // Find last answered question\n            const lastAnswered = Math.max(...Array.from(savedResponses.keys()), 0) as number;\n            setCurrentQuestionIndex(Math.min(lastAnswered + 1, data.questions.length - 1));\n          }\n        } else {\n          setError('Failed to load quiz questions');\n        }\n      } catch (err) {\n        setError('Failed to load quiz. Please refresh the page.');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchQuestions();\n  }, []);\n\n  // Auto-save responses to localStorage\n  useEffect(() => {\n    if (responses.size > 0) {\n      localStorage.setItem('quiz_responses', JSON.stringify(Array.from(responses.entries())));\n    }\n  }, [responses]);\n\n  // Load saved answer when question changes\n  useEffect(() => {\n    const currentQuestion = questions[currentQuestionIndex];\n    if (currentQuestion) {\n      const savedResponse = responses.get(currentQuestion.questionNumber);\n      setCurrentAnswer(savedResponse?.answer || null);\n    }\n  }, [currentQuestionIndex, questions, responses]);\n\n  const currentQuestion = questions[currentQuestionIndex];\n  const progress = ((currentQuestionIndex + 1) / questions.length) * 100;\n  const isLastQuestion = currentQuestionIndex === questions.length - 1;\n\n  // Calculate points for current answer\n  const calculatePoints = (answer: any): number => {\n    if (!currentQuestion || !answer) return 0;\n\n    const options = currentQuestion.options as any[];\n    const scoringWeight = currentQuestion.scoringWeight || 1;\n\n    if (currentQuestion.questionType === 'multiple_choice') {\n      const selectedOption = options?.find((opt) => opt.value === answer);\n      return (selectedOption?.score || 0) * scoringWeight;\n    } else if (currentQuestion.questionType === 'checkbox') {\n      if (!Array.isArray(answer)) return 0;\n      const totalScore = answer.reduce((sum, value) => {\n        const option = options?.find((opt) => opt.value === value);\n        return sum + (option?.score || 0);\n      }, 0);\n      return totalScore * scoringWeight;\n    } else if (currentQuestion.questionType === 'contact_info') {\n      return 0; // Contact info doesn't contribute to score\n    } else if (currentQuestion.questionType === 'text') {\n      return 0; // Text answers don't contribute to score\n    }\n\n    return 0;\n  };\n\n  const handleNext = () => {\n    if (!currentQuestion) return;\n\n    // Validate answer\n    if (currentQuestion.isRequired && !isAnswerValid()) {\n      alert('Please answer this question before continuing.');\n      return;\n    }\n\n    // Save response\n    const pointsEarned = calculatePoints(currentAnswer);\n    responses.set(currentQuestion.questionNumber, {\n      questionId: currentQuestion.id,\n      questionNumber: currentQuestion.questionNumber,\n      answer: currentAnswer,\n      pointsEarned,\n    });\n    setResponses(new Map(responses));\n\n    // Move to next question or submit\n    if (isLastQuestion) {\n      handleSubmit();\n    } else {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n    }\n  };\n\n  const handleSubmit = async () => {\n    setSubmitting(true);\n\n    try {\n      const res = await fetch('/api/assessment/submit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          responses: Array.from(responses.values()),\n        }),\n      });\n\n      const data = await res.json();\n\n      if (data.success) {\n        // Clear saved responses\n        localStorage.removeItem('quiz_responses');\n        // Redirect to results page\n        router.push(`/assessment/results/${data.leadId}`);\n      } else {\n        setError('Failed to submit assessment. Please try again.');\n        setSubmitting(false);\n      }\n    } catch (err) {\n      setError('Failed to submit assessment. Please try again.');\n      setSubmitting(false);\n    }\n  };\n\n  const isAnswerValid = (): boolean => {\n    if (!currentAnswer) return false;\n\n    if (currentQuestion.questionType === 'contact_info') {\n      const fields = currentQuestion.options as any[];\n      return fields.every((field: any) => {\n        if (!field.required) return true;\n        return currentAnswer[field.name] && currentAnswer[field.name].trim() !== '';\n      });\n    } else if (currentQuestion.questionType === 'checkbox') {\n      const minSelections = currentQuestion.minSelections || 0;\n      return Array.isArray(currentAnswer) && currentAnswer.length >= minSelections;\n    } else if (currentQuestion.questionType === 'text') {\n      return typeof currentAnswer === 'string' && currentAnswer.trim() !== '';\n    } else if (currentQuestion.questionType === 'multiple_choice') {\n      return typeof currentAnswer === 'string' && currentAnswer.trim() !== '';\n    }\n\n    return false;\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold text-destructive mb-4\">Error</h1>\n          <p className=\"text-muted-foreground\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!currentQuestion) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p className=\"text-muted-foreground\">No questions available</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-white/80 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"text-xl font-bold text-primary\">\n            Help Desk Health Assessment\n          </div>\n        </div>\n      </header>\n\n      {/* Progress Bar */}\n      <div className=\"bg-white border-b border-border\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium text-foreground\">\n              Question {currentQuestionIndex + 1} of {questions.length}\n            </span>\n            <span className=\"text-sm text-muted-foreground\">\n              {Math.round(progress)}% Complete\n            </span>\n          </div>\n          <div className=\"w-full h-2 bg-muted rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-primary transition-all duration-300\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Question Content */}\n      <main className=\"container mx-auto px-4 py-8 md:py-16\">\n        <div className=\"max-w-3xl mx-auto\">\n          <div className=\"bg-card border border-border rounded-lg shadow-sm p-6 md:p-8 mb-6\">\n            {/* Question Text */}\n            <div className=\"mb-6\">\n              <h2 className=\"text-2xl md:text-3xl font-bold text-foreground mb-2\">\n                {currentQuestion.questionText}\n              </h2>\n              {currentQuestion.questionSubtext && (\n                <p className=\"text-sm text-muted-foreground\">\n                  {currentQuestion.questionSubtext}\n                </p>\n              )}\n            </div>\n\n            {/* Question Input */}\n            <div className=\"space-y-4\">\n              {currentQuestion.questionType === 'contact_info' && (\n                <ContactInfoQuestion\n                  question={currentQuestion}\n                  value={currentAnswer || {}}\n                  onChange={setCurrentAnswer}\n                />\n              )}\n\n              {currentQuestion.questionType === 'multiple_choice' && (\n                <MultipleChoiceQuestion\n                  question={currentQuestion}\n                  value={currentAnswer}\n                  onChange={setCurrentAnswer}\n                />\n              )}\n\n              {currentQuestion.questionType === 'checkbox' && (\n                <CheckboxQuestion\n                  question={currentQuestion}\n                  value={currentAnswer || []}\n                  onChange={setCurrentAnswer}\n                />\n              )}\n\n              {currentQuestion.questionType === 'text' && (\n                <TextQuestion\n                  question={currentQuestion}\n                  value={currentAnswer || ''}\n                  onChange={setCurrentAnswer}\n                />\n              )}\n            </div>\n          </div>\n\n          {/* Navigation Buttons */}\n          <div className=\"flex items-center justify-between gap-4\">\n            <button\n              onClick={handleBack}\n              disabled={currentQuestionIndex === 0}\n              className=\"inline-flex items-center gap-2 px-6 py-3 text-sm font-medium text-muted-foreground hover:text-foreground disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              Back\n            </button>\n\n            <button\n              onClick={handleNext}\n              disabled={submitting || !isAnswerValid()}\n              className=\"inline-flex items-center gap-2 px-8 py-3 text-sm font-semibold text-primary-foreground bg-primary rounded-lg hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl\"\n            >\n              {submitting ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Submitting...\n                </>\n              ) : isLastQuestion ? (\n                <>\n                  Complete Assessment\n                  <CheckCircle className=\"w-4 h-4\" />\n                </>\n              ) : (\n                <>\n                  Next\n                  <ArrowRight className=\"w-4 h-4\" />\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Completion Indicators */}\n          <div className=\"mt-8 flex flex-wrap justify-center gap-2\">\n            {questions.map((q, index) => (\n              <div\n                key={q.id}\n                className={`w-3 h-3 rounded-full transition-colors ${\n                  responses.has(q.questionNumber)\n                    ? 'bg-primary'\n                    : index === currentQuestionIndex\n                    ? 'bg-accent'\n                    : 'bg-muted'\n                }`}\n                title={`Question ${index + 1}`}\n              />\n            ))}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n\n// Question Components\n\nfunction ContactInfoQuestion({\n  question,\n  value,\n  onChange,\n}: {\n  question: QuizQuestion;\n  value: Record<string, string>;\n  onChange: (value: Record<string, string>) => void;\n}) {\n  const fields = question.options as any[];\n\n  const handleFieldChange = (fieldName: string, fieldValue: string) => {\n    onChange({ ...value, [fieldName]: fieldValue });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {fields.map((field: any) => (\n        <div key={field.name}>\n          <label className=\"block text-sm font-medium text-foreground mb-2\">\n            {field.label}\n            {field.required && <span className=\"text-destructive ml-1\">*</span>}\n          </label>\n          <input\n            type={field.name === 'email' ? 'email' : field.name === 'phone' ? 'tel' : 'text'}\n            value={value[field.name] || ''}\n            onChange={(e) => handleFieldChange(field.name, e.target.value)}\n            className=\"w-full px-4 py-2 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring\"\n            required={field.required}\n          />\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction MultipleChoiceQuestion({\n  question,\n  value,\n  onChange,\n}: {\n  question: QuizQuestion;\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  const options = question.options as any[];\n\n  return (\n    <div className=\"space-y-3\">\n      {options.map((option: any) => (\n        <label\n          key={option.value}\n          className={`flex items-start gap-3 p-4 border rounded-lg cursor-pointer transition-all ${\n            value === option.value\n              ? 'border-primary bg-accent/10'\n              : 'border-border hover:border-accent'\n          }`}\n        >\n          <input\n            type=\"radio\"\n            name={`question-${question.id}`}\n            value={option.value}\n            checked={value === option.value}\n            onChange={(e) => onChange(e.target.value)}\n            className=\"mt-1 w-4 h-4 text-primary focus:ring-primary\"\n          />\n          <span className=\"flex-1 text-foreground\">{option.label}</span>\n        </label>\n      ))}\n    </div>\n  );\n}\n\nfunction CheckboxQuestion({\n  question,\n  value,\n  onChange,\n}: {\n  question: QuizQuestion;\n  value: string[];\n  onChange: (value: string[]) => void;\n}) {\n  const options = question.options as any[];\n\n  const handleToggle = (optionValue: string) => {\n    if (value.includes(optionValue)) {\n      onChange(value.filter((v) => v !== optionValue));\n    } else {\n      onChange([...value, optionValue]);\n    }\n  };\n\n  return (\n    <div className=\"space-y-3\">\n      {options.map((option: any) => (\n        <label\n          key={option.value}\n          className={`flex items-start gap-3 p-4 border rounded-lg cursor-pointer transition-all ${\n            value.includes(option.value)\n              ? 'border-primary bg-accent/10'\n              : 'border-border hover:border-accent'\n          }`}\n        >\n          <input\n            type=\"checkbox\"\n            value={option.value}\n            checked={value.includes(option.value)}\n            onChange={() => handleToggle(option.value)}\n            className=\"mt-1 w-4 h-4 text-primary rounded focus:ring-primary\"\n          />\n          <span className=\"flex-1 text-foreground\">{option.label}</span>\n        </label>\n      ))}\n    </div>\n  );\n}\n\nfunction TextQuestion({\n  question,\n  value,\n  onChange,\n}: {\n  question: QuizQuestion;\n  value: string;\n  onChange: (value: string) => void;\n}) {\n  return (\n    <textarea\n      value={value}\n      onChange={(e) => onChange(e.target.value)}\n      placeholder={question.placeholder || ''}\n      rows={4}\n      className=\"w-full px-4 py-3 border border-input rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none\"\n    />\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\assessment\\results\\[leadId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":33,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":51,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'score' is defined but never used. Allowed unused args must match /^_/u.","line":301,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { CheckCircle, ArrowRight, Loader2, TrendingUp, Target, Calendar, Mail } from 'lucide-react';\nimport Link from 'next/link';\n\ninterface AssessmentResult {\n  lead: {\n    id: string;\n    name: string;\n    email: string;\n    company: string | null;\n  };\n  score: {\n    readinessScore: number;\n    tier: 'cold' | 'warm' | 'hot' | 'qualified';\n    tierDescription: string;\n    totalPoints: number;\n    maxPossiblePoints: number;\n    breakdown: {\n      contactInfo: number;\n      currentState: number;\n      goals: number;\n      readiness: number;\n    };\n  };\n  responsesCount: number;\n}\n\nexport default function ResultsPage() {\n  const params = useParams();\n  const router = useRouter();\n  const [result, setResult] = useState<AssessmentResult | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const leadId = params.leadId as string;\n\n  useEffect(() => {\n    async function fetchResults() {\n      try {\n        const res = await fetch(`/api/assessment/results/${leadId}`);\n        const data = await res.json();\n\n        if (data.success) {\n          setResult(data);\n        } else {\n          setError(data.error || 'Failed to load results');\n        }\n      } catch (err) {\n        setError('Failed to load assessment results');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    if (leadId) {\n      fetchResults();\n    }\n  }, [leadId]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (error || !result) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <div className=\"max-w-md text-center\">\n          <h1 className=\"text-2xl font-bold text-destructive mb-4\">Error</h1>\n          <p className=\"text-muted-foreground mb-6\">{error || 'Results not found'}</p>\n          <Link\n            href=\"/assessment\"\n            className=\"inline-flex items-center gap-2 text-primary hover:underline\"\n          >\n            Return to Assessment\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const { lead, score } = result;\n  const tierConfig = getTierConfig(score.tier, score.readinessScore);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-white/80 backdrop-blur-sm\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"text-xl font-bold text-primary\">\n            Timeless Technology Solutions\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-8 md:py-16\">\n        <div className=\"max-w-4xl mx-auto\">\n          {/* Success Header */}\n          <div className=\"text-center mb-8\">\n            <div className=\"inline-flex items-center justify-center w-16 h-16 bg-chart-4/10 rounded-full mb-4\">\n              <CheckCircle className=\"w-8 h-8 text-chart-4\" />\n            </div>\n            <h1 className=\"text-3xl md:text-4xl font-bold text-foreground mb-2\">\n              Assessment Complete!\n            </h1>\n            <p className=\"text-lg text-muted-foreground\">\n              Thank you, {lead.name}. Here are your results.\n            </p>\n          </div>\n\n          {/* Score Card */}\n          <div className={`bg-card border-2 rounded-lg shadow-lg p-8 mb-8 ${tierConfig.borderColor}`}>\n            <div className=\"flex flex-col md:flex-row items-center gap-8\">\n              {/* Score Circle */}\n              <div className=\"flex-shrink-0\">\n                <div className=\"relative w-40 h-40\">\n                  <svg className=\"transform -rotate-90 w-40 h-40\">\n                    <circle\n                      cx=\"80\"\n                      cy=\"80\"\n                      r=\"70\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"12\"\n                      fill=\"transparent\"\n                      className=\"text-muted\"\n                    />\n                    <circle\n                      cx=\"80\"\n                      cy=\"80\"\n                      r=\"70\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"12\"\n                      fill=\"transparent\"\n                      strokeDasharray={`${2 * Math.PI * 70}`}\n                      strokeDashoffset={`${2 * Math.PI * 70 * (1 - score.readinessScore / 100)}`}\n                      className={tierConfig.scoreColor}\n                      strokeLinecap=\"round\"\n                    />\n                  </svg>\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <div className=\"text-4xl font-bold text-foreground\">{score.readinessScore}%</div>\n                      <div className=\"text-sm text-muted-foreground\">Ready</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Tier Info */}\n              <div className=\"flex-1 text-center md:text-left\">\n                <div className={`inline-block px-4 py-2 rounded-full text-sm font-semibold mb-3 ${tierConfig.badgeClass}`}>\n                  {tierConfig.label}\n                </div>\n                <h2 className=\"text-2xl font-bold text-foreground mb-2\">\n                  {tierConfig.title}\n                </h2>\n                <p className=\"text-muted-foreground mb-4\">\n                  {tierConfig.description}\n                </p>\n                <div className=\"text-sm text-muted-foreground\">\n                  Based on {result.responsesCount} questions • Score: {score.totalPoints} / {score.maxPossiblePoints} points\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Score Breakdown */}\n          <div className=\"bg-card border border-border rounded-lg shadow-sm p-6 mb-8\">\n            <h3 className=\"text-xl font-bold text-foreground mb-4\">Score Breakdown</h3>\n            <div className=\"space-y-4\">\n              <ScoreBar\n                label=\"Company & Industry\"\n                value={score.breakdown.contactInfo}\n                maxValue={60}\n                color=\"chart-1\"\n              />\n              <ScoreBar\n                label=\"Current Help Desk State\"\n                value={score.breakdown.currentState}\n                maxValue={200}\n                color=\"chart-2\"\n              />\n              <ScoreBar\n                label=\"Goals & Strategic Fit\"\n                value={score.breakdown.goals}\n                maxValue={150}\n                color=\"chart-3\"\n              />\n              <ScoreBar\n                label=\"Readiness Indicators\"\n                value={score.breakdown.readiness}\n                maxValue={289}\n                color=\"chart-4\"\n              />\n            </div>\n          </div>\n\n          {/* What Happens Next */}\n          <div className=\"bg-card border border-border rounded-lg shadow-sm p-6 mb-8\">\n            <h3 className=\"text-xl font-bold text-foreground mb-4 flex items-center gap-2\">\n              <TrendingUp className=\"w-5 h-5\" />\n              What Happens Next\n            </h3>\n            <div className=\"space-y-4\">\n              {tierConfig.nextSteps.map((step, index) => (\n                <div key={index} className=\"flex gap-4\">\n                  <div className=\"flex-shrink-0 w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center font-bold text-sm\">\n                    {index + 1}\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-foreground mb-1\">{step.title}</h4>\n                    <p className=\"text-sm text-muted-foreground\">{step.description}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* CTA Section */}\n          <div className={`rounded-lg p-8 text-center ${tierConfig.ctaBackground}`}>\n            <h3 className=\"text-2xl font-bold text-foreground mb-3\">\n              {tierConfig.ctaTitle}\n            </h3>\n            <p className=\"text-muted-foreground mb-6 max-w-2xl mx-auto\">\n              {tierConfig.ctaDescription}\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              {tierConfig.primaryCta && (\n                <a\n                  href={tierConfig.primaryCta.link}\n                  className=\"inline-flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-primary-foreground bg-primary rounded-lg hover:bg-primary/90 transition-all shadow-lg hover:shadow-xl\"\n                >\n                  {tierConfig.primaryCta.icon}\n                  {tierConfig.primaryCta.text}\n                </a>\n              )}\n              {tierConfig.secondaryCta && (\n                <a\n                  href={tierConfig.secondaryCta.link}\n                  className=\"inline-flex items-center justify-center gap-2 px-8 py-3 text-lg font-semibold text-foreground bg-card border-2 border-border rounded-lg hover:bg-muted transition-all\"\n                >\n                  {tierConfig.secondaryCta.icon}\n                  {tierConfig.secondaryCta.text}\n                </a>\n              )}\n            </div>\n          </div>\n\n          {/* Footer Note */}\n          <div className=\"mt-8 text-center text-sm text-muted-foreground\">\n            <p>\n              Questions? Contact us at{' '}\n              <a href=\"https://timelesstechs.com/#contact\" className=\"text-accent hover:underline\">\n                timelesstechs.com\n              </a>\n            </p>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nfunction ScoreBar({\n  label,\n  value,\n  maxValue,\n  color,\n}: {\n  label: string;\n  value: number;\n  maxValue: number;\n  color: string;\n}) {\n  const percentage = Math.min((value / maxValue) * 100, 100);\n\n  return (\n    <div>\n      <div className=\"flex justify-between text-sm mb-2\">\n        <span className=\"font-medium text-foreground\">{label}</span>\n        <span className=\"text-muted-foreground\">\n          {value} / {maxValue} pts\n        </span>\n      </div>\n      <div className=\"w-full h-3 bg-muted rounded-full overflow-hidden\">\n        <div\n          className={`h-full bg-${color} transition-all duration-500`}\n          style={{ width: `${percentage}%` }}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction getTierConfig(tier: string, score: number) {\n  switch (tier) {\n    case 'qualified':\n      return {\n        label: 'QUALIFIED LEAD',\n        title: 'High Priority - Ready to Buy',\n        description:\n          'Your help desk shows strong readiness for DDIP analysis. We\\'re preparing a personalized proposal based on your specific needs.',\n        borderColor: 'border-chart-4',\n        scoreColor: 'text-chart-4',\n        badgeClass: 'bg-chart-4/10 text-chart-4',\n        ctaBackground: 'bg-chart-4/10 border border-chart-4/20',\n        ctaTitle: 'Let\\'s Get Started',\n        ctaDescription:\n          'Our team will reach out within 24 hours to discuss your DDIP implementation and share sample insights from similar help desks.',\n        primaryCta: {\n          text: 'Schedule Strategy Call',\n          link: 'https://timelesstechs.com/#contact',\n          icon: <Calendar className=\"w-5 h-5\" />,\n        },\n        secondaryCta: {\n          text: 'Email Us',\n          link: 'mailto:contact@timelesstechs.com',\n          icon: <Mail className=\"w-5 h-5\" />,\n        },\n        nextSteps: [\n          {\n            title: 'Personalized Analysis (24-48 hours)',\n            description:\n              'Our AI is researching your company and help desk environment to create a customized DDIP proposal.',\n          },\n          {\n            title: 'Strategy Call',\n            description:\n              'We\\'ll show you sample insights from similar help desks and discuss your specific improvement opportunities.',\n          },\n          {\n            title: 'DDIP Implementation',\n            description:\n              'If it\\'s a fit, we\\'ll start analyzing your help desk data and deliver actionable recommendations within 2-3 weeks.',\n          },\n        ],\n      };\n\n    case 'hot':\n      return {\n        label: 'HOT LEAD',\n        title: 'Strong Fit - Near-Term Opportunity',\n        description:\n          'Your help desk has significant improvement potential. We\\'re preparing personalized insights to show what DDIP could discover.',\n        borderColor: 'border-chart-5',\n        scoreColor: 'text-chart-5',\n        badgeClass: 'bg-chart-5/10 text-chart-5',\n        ctaBackground: 'bg-chart-5/10 border border-chart-5/20',\n        ctaTitle: 'Discover Your Improvement Potential',\n        ctaDescription:\n          'We\\'ll contact you soon with sample insights showing what DDIP would uncover in your help desk data.',\n        primaryCta: {\n          text: 'Book a Call',\n          link: 'https://timelesstechs.com/#contact',\n          icon: <Calendar className=\"w-5 h-5\" />,\n        },\n        secondaryCta: {\n          text: 'Learn More About DDIP',\n          link: 'https://timelesstechs.com',\n          icon: <Target className=\"w-5 h-5\" />,\n        },\n        nextSteps: [\n          {\n            title: 'Personalized Insights (2-3 days)',\n            description:\n              'We\\'ll research your help desk environment and share examples of what DDIP typically discovers in similar organizations.',\n          },\n          {\n            title: 'Review Sample Analysis',\n            description:\n              'See a sample DDIP report showing potential improvements, cost savings, and root cause identification.',\n          },\n          {\n            title: 'Optional Strategy Call',\n            description:\n              'If interested, we\\'ll discuss implementing DDIP for your help desk.',\n          },\n        ],\n      };\n\n    case 'warm':\n      return {\n        label: 'WARM LEAD',\n        title: 'Potential Fit - Mid-Term Nurture',\n        description:\n          'Your help desk could benefit from DDIP, but timing or readiness may need development. Let\\'s stay in touch.',\n        borderColor: 'border-chart-2',\n        scoreColor: 'text-chart-2',\n        badgeClass: 'bg-chart-2/10 text-chart-2',\n        ctaBackground: 'bg-chart-2/10 border border-chart-2/20',\n        ctaTitle: 'Stay Connected',\n        ctaDescription:\n          'We\\'ll send you helpful resources about help desk optimization and case studies showing DDIP results.',\n        primaryCta: {\n          text: 'Get Free Resources',\n          link: 'https://timelesstechs.com/#contact',\n          icon: <Mail className=\"w-5 h-5\" />,\n        },\n        secondaryCta: {\n          text: 'Retake Assessment',\n          link: '/assessment/quiz',\n          icon: <ArrowRight className=\"w-5 h-5\" />,\n        },\n        nextSteps: [\n          {\n            title: 'Receive Educational Content',\n            description:\n              'We\\'ll email case studies and guides about help desk process improvement and data-driven insights.',\n          },\n          {\n            title: 'Join Our Workshop (Optional)',\n            description:\n              'Get invited to webinars showing live DDIP demonstrations and help desk optimization strategies.',\n          },\n          {\n            title: 'Retake When Ready',\n            description:\n              'As your help desk matures or budget/timeline aligns, retake the assessment to explore DDIP implementation.',\n          },\n        ],\n      };\n\n    case 'cold':\n    default:\n      return {\n        label: 'EARLY STAGE',\n        title: 'Early Stage - Long-Term Nurture',\n        description:\n          'DDIP works best with established help desks and clear improvement goals. Let\\'s stay in touch as your needs evolve.',\n        borderColor: 'border-muted',\n        scoreColor: 'text-muted-foreground',\n        badgeClass: 'bg-muted text-muted-foreground',\n        ctaBackground: 'bg-muted/30 border border-muted',\n        ctaTitle: 'Build Your Foundation',\n        ctaDescription:\n          'We\\'ll share resources to help you establish help desk best practices and prepare for data-driven optimization.',\n        primaryCta: {\n          text: 'Get Help Desk Resources',\n          link: 'https://timelesstechs.com/#contact',\n          icon: <Mail className=\"w-5 h-5\" />,\n        },\n        secondaryCta: null,\n        nextSteps: [\n          {\n            title: 'Foundational Resources',\n            description:\n              'Receive guides on help desk setup, ticketing best practices, and metrics to track.',\n          },\n          {\n            title: 'Build Your Data History',\n            description:\n              'Focus on collecting 12-18 months of ticket data - this is essential for DDIP to deliver value.',\n          },\n          {\n            title: 'Reconnect in 6-12 Months',\n            description:\n              'Once your help desk is established and you have data history, retake the assessment to explore DDIP.',\n          },\n        ],\n      };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\select-organization\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\sign-in\\[[...sign-in]]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\app\\sign-up\\[[...sign-up]]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\lead-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\quiz-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[640,643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[640,643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tenantSlug' is defined but never used. Allowed unused args must match /^_/u.","line":24,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[876,879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[876,879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1842,1845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1842,1845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1913,1916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1913,1916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2718,2721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2718,2721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3024,3027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3024,3027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4178,4181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4178,4181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5589,5592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5589,5592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { ArrowRight, ArrowLeft, Check } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { QuizQuestion } from '@/lib/quiz-types';\n\n/**\n * Quiz Form Component\n * Multi-step form that renders tenant-specific quiz questions\n * Handles contact info, multiple choice, checkbox, and text questions\n */\n\ntype QuizFormProps = {\n  questions: QuizQuestion[];\n  tenantSlug: string;\n  primaryColor: string;\n  onComplete: (responses: Record<string, any>) => Promise<void>;\n};\n\nexport function QuizForm({ questions, tenantSlug, primaryColor, onComplete }: QuizFormProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [responses, setResponses] = useState<Record<string, any>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const currentQuestion = questions[currentStep];\n  const isLastQuestion = currentStep === questions.length - 1;\n  const progress = ((currentStep + 1) / questions.length) * 100;\n\n  const handleNext = () => {\n    // Validate current question\n    if (!validateCurrentQuestion()) {\n      toast.error('Please answer this question to continue');\n      return;\n    }\n\n    if (isLastQuestion) {\n      handleSubmit();\n    } else {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const validateCurrentQuestion = (): boolean => {\n    if (!currentQuestion.isRequired) return true;\n\n    const answer = responses[currentQuestion.id];\n\n    if (currentQuestion.questionType === 'contact_info') {\n      // Check all required fields\n      const requiredFields = currentQuestion.options?.filter((opt: any) => opt.required) || [];\n      return requiredFields.every((field: any) => {\n        const value = answer?.[field.name || ''];\n        return value && value.trim() !== '';\n      });\n    }\n\n    if (currentQuestion.questionType === 'checkbox') {\n      const minSelections = currentQuestion.minSelections || 1;\n      return Array.isArray(answer) && answer.length >= minSelections;\n    }\n\n    return answer !== undefined && answer !== null && answer !== '';\n  };\n\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    try {\n      await onComplete(responses);\n      toast.success('Quiz submitted successfully!');\n    } catch (error) {\n      console.error('Error submitting quiz:', error);\n      toast.error('Failed to submit quiz. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const updateResponse = (questionId: string, value: any) => {\n    setResponses((prev) => ({\n      ...prev,\n      [questionId]: value,\n    }));\n  };\n\n  const renderQuestion = () => {\n    switch (currentQuestion.questionType) {\n      case 'contact_info':\n        return (\n          <div className=\"space-y-4\">\n            {currentQuestion.options?.map((field: any) => (\n              <div key={field.name} className=\"space-y-2\">\n                <Label htmlFor={field.name}>\n                  {field.label}\n                  {field.required && <span className=\"text-destructive ml-1\">*</span>}\n                </Label>\n                <Input\n                  id={field.name}\n                  name={field.name}\n                  type={field.name === 'email' ? 'email' : field.name === 'phone' ? 'tel' : 'text'}\n                  placeholder={field.label}\n                  value={responses[currentQuestion.id]?.[field.name || ''] || ''}\n                  onChange={(e) => {\n                    const contactInfo = responses[currentQuestion.id] || {};\n                    updateResponse(currentQuestion.id, {\n                      ...contactInfo,\n                      [field.name || '']: e.target.value,\n                    });\n                  }}\n                  required={field.required}\n                />\n              </div>\n            ))}\n          </div>\n        );\n\n      case 'multiple_choice':\n        return (\n          <div className=\"space-y-3\">\n            {currentQuestion.options?.map((option: any) => (\n              <button\n                key={option.value}\n                type=\"button\"\n                onClick={() => updateResponse(currentQuestion.id, option.value)}\n                className={`w-full text-left p-4 rounded-lg border-2 transition-all hover:border-opacity-60 ${\n                  responses[currentQuestion.id] === option.value\n                    ? 'border-current bg-current bg-opacity-5'\n                    : 'border-border hover:bg-muted'\n                }`}\n                style={\n                  responses[currentQuestion.id] === option.value\n                    ? { borderColor: primaryColor, color: primaryColor }\n                    : {}\n                }\n              >\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium\">{option.label}</span>\n                  {responses[currentQuestion.id] === option.value && (\n                    <Check className=\"w-5 h-5\" style={{ color: primaryColor }} />\n                  )}\n                </div>\n              </button>\n            ))}\n          </div>\n        );\n\n      case 'checkbox':\n        return (\n          <div className=\"space-y-3\">\n            {currentQuestion.questionSubtext && (\n              <p className=\"text-sm text-muted-foreground mb-4\">{currentQuestion.questionSubtext}</p>\n            )}\n            {currentQuestion.options?.map((option: any) => {\n              const selected = Array.isArray(responses[currentQuestion.id])\n                ? responses[currentQuestion.id].includes(option.value)\n                : false;\n\n              return (\n                <button\n                  key={option.value}\n                  type=\"button\"\n                  onClick={() => {\n                    const current = responses[currentQuestion.id] || [];\n                    const newValue = selected\n                      ? current.filter((v: string) => v !== option.value)\n                      : [...current, option.value];\n                    updateResponse(currentQuestion.id, newValue);\n                  }}\n                  className={`w-full text-left p-4 rounded-lg border-2 transition-all hover:border-opacity-60 ${\n                    selected\n                      ? 'border-current bg-current bg-opacity-5'\n                      : 'border-border hover:bg-muted'\n                  }`}\n                  style={selected ? { borderColor: primaryColor, color: primaryColor } : {}}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"font-medium\">{option.label}</span>\n                    {selected && <Check className=\"w-5 h-5\" style={{ color: primaryColor }} />}\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        );\n\n      case 'text':\n        return (\n          <div className=\"space-y-2\">\n            {currentQuestion.questionSubtext && (\n              <p className=\"text-sm text-muted-foreground\">{currentQuestion.questionSubtext}</p>\n            )}\n            <Input\n              type=\"text\"\n              placeholder={currentQuestion.placeholder || 'Type your answer...'}\n              value={responses[currentQuestion.id] || ''}\n              onChange={(e) => updateResponse(currentQuestion.id, e.target.value)}\n              className=\"text-base\"\n            />\n          </div>\n        );\n\n      default:\n        return <p>Unknown question type</p>;\n    }\n  };\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      {/* Progress Bar */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm font-medium text-muted-foreground\">\n            Question {currentStep + 1} of {questions.length}\n          </span>\n          <span className=\"text-sm font-medium text-muted-foreground\">{Math.round(progress)}%</span>\n        </div>\n        <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n          <div\n            className=\"h-full transition-all duration-300\"\n            style={{ width: `${progress}%`, backgroundColor: primaryColor }}\n          />\n        </div>\n      </div>\n\n      {/* Question Card */}\n      <div className=\"bg-card border border-border rounded-lg p-8 mb-6\">\n        <h2 className=\"text-2xl font-bold text-foreground mb-2\">\n          {currentQuestion.questionText}\n        </h2>\n        {currentQuestion.questionSubtext && currentQuestion.questionType !== 'checkbox' && (\n          <p className=\"text-muted-foreground mb-6\">{currentQuestion.questionSubtext}</p>\n        )}\n\n        <div className=\"mt-6\">{renderQuestion()}</div>\n      </div>\n\n      {/* Navigation Buttons */}\n      <div className=\"flex items-center justify-between\">\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={handleBack}\n          disabled={currentStep === 0}\n          className=\"gap-2\"\n        >\n          <ArrowLeft className=\"w-4 h-4\" />\n          Back\n        </Button>\n\n        <Button\n          type=\"button\"\n          onClick={handleNext}\n          disabled={isSubmitting}\n          className=\"gap-2 text-white\"\n          style={{ backgroundColor: primaryColor }}\n        >\n          {isLastQuestion ? (\n            <>\n              {isSubmitting ? 'Submitting...' : 'Submit Quiz'}\n              <Check className=\"w-4 h-4\" />\n            </>\n          ) : (\n            <>\n              Next\n              <ArrowRight className=\"w-4 h-4\" />\n            </>\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\seed-email-sequences.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":255,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":255,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '.';\nimport { emailSequences } from './schema';\n\nconst DEFAULT_ORG_ID = 'default';\n\n/**\n * Email nurture sequences for different lead tiers\n * - COLD tier: Long-term nurture with foundational resources\n * - WARM tier: Mid-term nurture with educational content and use cases\n */\nconst EMAIL_SEQUENCES = [\n  // COLD LEAD NURTURE SEQUENCE\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 1,\n    delayDays: 0, // Immediate after assessment\n    subject: 'Thanks for Your Help Desk Assessment - Building Your Foundation',\n    body: `Hi {{name}},\n\nThank you for completing the Help Desk Health Assessment for {{company}}!\n\nYour assessment shows you're in the early stages of help desk optimization. That's perfectly fine - every great help desk started somewhere!\n\n**Your Next Steps:**\n\n1. **Build Data History**: Our DDIP (Data-Driven Insights Platform) works best with 12-18 months of ticket data. Focus on collecting comprehensive data now.\n\n2. **Establish Best Practices**: We've attached a guide on help desk ticketing fundamentals and key metrics to track.\n\n3. **Prepare for Data-Driven Analysis**: Once you have solid data history, DDIP can identify hidden patterns and improvement opportunities you'd never spot manually.\n\n**Free Resource Included:**\n📋 Help Desk Best Practices Checklist\n📊 Essential Metrics Guide\n\nWe'll check back in a few months to see how you're progressing. In the meantime, feel free to reach out with any questions.\n\nBest regards,\nTimeless Technology Solutions\nhttps://timelesstechs.com/#contact`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 2,\n    delayDays: 30, // 1 month later\n    subject: 'Help Desk Metrics: What to Track & Why',\n    body: `Hi {{name}},\n\nHope your help desk at {{company}} is growing!\n\nWe wanted to share some insights on the metrics that matter most when you're building your help desk foundation:\n\n**Core Metrics to Track:**\n- First Response Time (FRT)\n- Resolution Time\n- Ticket Volume by Category\n- Customer Satisfaction (CSAT)\n- Repeat Ticket Rate\n\n**Why These Matter:**\nOnce you have 12+ months of this data, DDIP can analyze trends and reveal:\n- Which categories generate the most tickets (and why)\n- Root causes of recurring issues\n- Opportunities for process improvements\n- Potential cost savings from automation\n\n**Quick Question:** How many months of ticket data do you currently have? Reply to this email and let us know where you're at.\n\nBest,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'cold',\n    sequenceNumber: 3,\n    delayDays: 90, // 3 months after initial\n    subject: 'Ready to Revisit Your Help Desk Assessment?',\n    body: `Hi {{name}},\n\nIt's been a few months since you completed our Help Desk Health Assessment.\n\nIf you've been building your ticket data history and establishing best practices, you might be ready for a deeper analysis now.\n\n**Has Anything Changed?**\n- Do you now have 12+ months of ticket data?\n- Has your ticket volume increased?\n- Are you tracking metrics consistently?\n- Do you have budget allocated for help desk improvement?\n\nIf yes to 2 or more, **retake the assessment** to see if you're ready for DDIP:\n👉 https://timelesstechs.com/assessment\n\nOr simply reply to schedule a quick 15-minute call to discuss where you're at.\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n\n  // WARM LEAD NURTURE SEQUENCE\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 1,\n    delayDays: 0, // Immediate\n    subject: 'Your Help Desk Assessment Results - Next Steps for {{company}}',\n    body: `Hi {{name}},\n\nThank you for completing the Help Desk Health Assessment! Your score of {{score}}% shows that {{company}} has potential for significant improvement through data-driven insights.\n\n**What Your Score Means:**\nYour help desk shows promise, but timing or readiness may need development. You're in good company - many organizations at this stage see 20-30% efficiency gains once they implement DDIP.\n\n**Resources We're Sending You:**\n\n📊 **Case Study**: How a similar-sized help desk reduced ticket volume by 28% using DDIP\n🎯 **Guide**: \"5 Hidden Patterns in Your Help Desk Data\"\n📈 **Webinar Invite**: Live DDIP demonstration (next session in 2 weeks)\n\n**Common Questions We Get:**\n\nQ: \"What makes DDIP different from regular reporting?\"\nA: DDIP identifies ROOT CAUSES, not just symptoms. It connects data points across your entire operation to reveal why issues happen.\n\nQ: \"How much data do we need?\"\nA: Ideally 12-18 months of ticket history for meaningful pattern analysis.\n\nWant to discuss your specific situation? **Book a 20-minute call** here:\n👉 https://timelesstechs.com/#contact\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 2,\n    delayDays: 7, // 1 week later\n    subject: 'Case Study: 28% Ticket Reduction Using DDIP',\n    body: `Hi {{name}},\n\nFollowing up on your help desk assessment - I wanted to share a relevant case study.\n\n**The Challenge:**\nA mid-sized SaaS company (similar to {{company}}) had 800+ tickets/month but couldn't identify why certain issues kept recurring.\n\n**What DDIP Discovered:**\n- 31% of tickets were actually related to ONE root cause (unclear onboarding documentation)\n- 18% of \"different\" issues all traced back to a single software configuration\n- Peak ticket times correlated with specific product features\n\n**The Results:**\n- 28% reduction in monthly tickets within 90 days\n- 40% faster resolution times\n- $47K annual savings in support costs\n\n**Could This Work for You?**\n\nBased on your assessment, you might see similar patterns in your data. The key is having the right analysis approach.\n\n**FREE Workshop Invitation:**\nJoin our next \"DDIP Demonstration\" webinar to see live analysis of help desk data.\n📅 Next session: [Date TBD]\n🔗 Register here: [Link]\n\nNo pressure - just sharing resources that might help {{company}} improve efficiency.\n\nBest,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 3,\n    delayDays: 21, // 3 weeks total\n    subject: '5 Hidden Patterns in Your Help Desk Data',\n    body: `Hi {{name}},\n\nMost help desks track metrics like \"tickets per day\" or \"average resolution time,\" but the real insights are hiding in the patterns between data points.\n\n**5 Patterns DDIP Commonly Finds:**\n\n1. **The Onboarding Spike**: New user tickets cluster around specific features (fixable with better documentation)\n\n2. **The Silent Killer**: Low-priority tickets that consume 40% of team time when aggregated\n\n3. **The Hidden Dependency**: Tickets in one category actually caused by issues in another department\n\n4. **The Time Bomb**: Gradually increasing ticket types that signal bigger problems coming\n\n5. **The Knowledge Gap**: Same questions from different customers (opportunity for self-service)\n\n**Your Help Desk at {{company}}:**\nBased on your {{score}}% assessment score, you likely have at least 2-3 of these patterns happening right now.\n\n**Want to Find Out Which Ones?**\n\nWe can run a quick preliminary analysis on a sample of your ticket data (completely confidential). Takes about 30 minutes.\n\nInterested? **Reply to this email** or book time here:\n👉 https://timelesstechs.com/#contact\n\nBest regards,\nTimeless Technology Solutions`,\n    isActive: true,\n  },\n  {\n    orgId: DEFAULT_ORG_ID,\n    tier: 'warm',\n    sequenceNumber: 4,\n    delayDays: 45, // ~6 weeks total\n    subject: 'Still Thinking About Help Desk Optimization?',\n    body: `Hi {{name}},\n\nJust checking in - I know help desk improvement might not be top priority right now for {{company}}.\n\n**No worries if timing isn't right yet.** But I wanted to leave you with one thought:\n\nEvery month you wait to implement data-driven insights is another month of:\n- Repeated issues that could be prevented\n- Team time spent on symptoms instead of root causes\n- Hidden costs you don't even know exist yet\n\n**When You're Ready:**\n\n✅ Retake the assessment if circumstances have changed\n✅ Book a strategy call to discuss timing\n✅ Join our email list for ongoing tips (no spam, promise)\n\nOr simply **reply \"not now\"** and I'll check back in 6 months.\n\nThanks for your time,\nTimeless Technology Solutions\n\nP.S. - Quick question: What would need to change for help desk optimization to become a priority? Budget? Team size? Management buy-in? Your answer helps us serve you better.`,\n    isActive: true,\n  },\n];\n\n/**\n * Seeds the email sequences for nurture campaigns\n */\nasync function seedEmailSequences() {\n  console.log('Seeding email sequences...');\n\n  // Clear existing sequences for DEFAULT_ORG_ID (skip if error)\n  try {\n    await db.delete(emailSequences);\n  } catch (error) {\n    console.log('Note: Could not clear existing sequences (table might be empty)');\n  }\n\n  // Insert new sequences\n  await db.insert(emailSequences).values(EMAIL_SEQUENCES);\n\n  console.log(`✅ Seeded ${EMAIL_SEQUENCES.length} email sequences`);\n  console.log(`   - COLD tier: 3 emails (0, 30, 90 days)`);\n  console.log(`   - WARM tier: 4 emails (0, 7, 21, 45 days)`);\n}\n\n// Run if called directly\nif (require.main === module) {\n  seedEmailSequences()\n    .then(() => {\n      console.log('Email sequences seeded successfully!');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('Error seeding email sequences:', error);\n      process.exit(1);\n    });\n}\n\nexport { seedEmailSequences };\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\seed-quiz-multi-tenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\seed-quiz.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":360,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13533,13536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13533,13536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":363,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13750,13753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13750,13753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Seed script for Help Desk Assessment Quiz\n * Populates quiz_questions table with Timeless Technology Solutions' help desk assessment\n */\n\nimport { drizzle } from 'drizzle-orm/neon-http';\nimport { neon } from '@neondatabase/serverless';\nimport { quizQuestions } from './schema';\nimport { eq } from 'drizzle-orm';\n\n// Use HTTP driver for Node.js scripts (WebSocket driver doesn't work in Node)\nconst sql = neon(process.env.DATABASE_URL!);\nconst db = drizzle(sql);\n\nconst DEFAULT_ORG_ID = 'default'; // For Phase 1, all questions use default org\n\nconst HELP_DESK_QUIZ_QUESTIONS = [\n  // Question 1: Contact Info\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 1,\n    questionType: 'contact_info',\n    questionText: \"Let's start with your contact information\",\n    questionSubtext: null,\n    options: [\n      { name: 'full_name', label: 'Full Name', required: true },\n      { name: 'email', label: 'Work Email', required: true },\n      { name: 'phone', label: 'Phone Number', required: false },\n      { name: 'company', label: 'Company Name', required: true },\n      { name: 'job_title', label: 'Job Title', required: true },\n    ],\n    scoringWeight: 0,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 2: Company Size\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 2,\n    questionType: 'multiple_choice',\n    questionText: 'How many employees does your organization have?',\n    questionSubtext: null,\n    options: [\n      { value: '1-50', label: '1-50 employees', score: 5 },\n      { value: '51-200', label: '51-200 employees', score: 10 },\n      { value: '201-500', label: '201-500 employees', score: 15 },\n      { value: '501-1000', label: '501-1,000 employees', score: 20 },\n      { value: '1001+', label: '1,001+ employees', score: 20 },\n    ],\n    scoringWeight: 1,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 3: Industry\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 3,\n    questionType: 'multiple_choice',\n    questionText: 'What industry is your organization in?',\n    questionSubtext: null,\n    options: [\n      { value: 'healthcare', label: 'Healthcare', score: 15 },\n      { value: 'finance', label: 'Finance/Banking', score: 15 },\n      { value: 'technology', label: 'Technology/SaaS', score: 15 },\n      { value: 'manufacturing', label: 'Manufacturing', score: 12 },\n      { value: 'retail', label: 'Retail/E-commerce', score: 12 },\n      { value: 'education', label: 'Education', score: 10 },\n      { value: 'government', label: 'Government/Non-profit', score: 8 },\n      { value: 'other', label: 'Other', score: 5 },\n    ],\n    scoringWeight: 1,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 4: Help Desk Size\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 4,\n    questionType: 'multiple_choice',\n    questionText: 'How many people are on your help desk/IT support team?',\n    questionSubtext: null,\n    options: [\n      { value: 'none', label: \"We don't have a dedicated help desk\", score: 5 },\n      { value: '1-2', label: '1-2 people', score: 8 },\n      { value: '3-5', label: '3-5 people', score: 15 },\n      { value: '6-10', label: '6-10 people', score: 20 },\n      { value: '11+', label: '11+ people', score: 20 },\n    ],\n    scoringWeight: 2,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 5: Ticket Volume\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 5,\n    questionType: 'multiple_choice',\n    questionText: 'Approximately how many support tickets do you receive per month?',\n    questionSubtext: null,\n    options: [\n      { value: '0-50', label: '0-50 tickets', score: 3 },\n      { value: '51-200', label: '51-200 tickets', score: 8 },\n      { value: '201-500', label: '201-500 tickets', score: 15 },\n      { value: '501-1000', label: '501-1,000 tickets', score: 20 },\n      { value: '1001+', label: '1,001+ tickets', score: 25 },\n    ],\n    scoringWeight: 2,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 6: Help Desk Software\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 6,\n    questionType: 'multiple_choice',\n    questionText: 'What help desk/ticketing system do you currently use?',\n    questionSubtext: \"We'll use this to understand what data DDIP can analyze\",\n    options: [\n      { value: 'zendesk', label: 'Zendesk', score: 15, ddip_compatible: true },\n      { value: 'freshdesk', label: 'Freshdesk', score: 15, ddip_compatible: true },\n      { value: 'servicenow', label: 'ServiceNow', score: 20, ddip_compatible: true },\n      { value: 'jira', label: 'Jira Service Management', score: 15, ddip_compatible: true },\n      { value: 'salesforce', label: 'Salesforce Service Cloud', score: 15, ddip_compatible: true },\n      { value: 'email', label: 'Email/Spreadsheets', score: 5, ddip_compatible: false },\n      { value: 'other', label: 'Other system', score: 10, ddip_compatible: true },\n      { value: 'none', label: 'No formal system', score: 3, ddip_compatible: false },\n    ],\n    scoringWeight: 1,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 7: Pain Points (Multi-select)\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 7,\n    questionType: 'checkbox',\n    questionText: 'What are your biggest help desk challenges? (Select all that apply)',\n    questionSubtext: null,\n    options: [\n      { value: 'slow_response', label: 'Slow response times', score: 5 },\n      { value: 'high_volume', label: 'Overwhelming ticket volume', score: 5 },\n      { value: 'repeat_issues', label: 'Same issues keep recurring', score: 8 },\n      { value: 'no_visibility', label: 'Lack of visibility into problems', score: 8 },\n      { value: 'manual_processes', label: 'Too many manual processes', score: 8 },\n      { value: 'knowledge_gaps', label: 'Knowledge gaps on the team', score: 5 },\n      { value: 'no_metrics', label: \"Don't have meaningful metrics\", score: 10 },\n      { value: 'root_cause', label: \"Can't identify root causes\", score: 10 },\n    ],\n    scoringWeight: 2,\n    isRequired: true,\n    placeholder: null,\n    minSelections: 1,\n  },\n\n  // Question 8: Current Metrics\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 8,\n    questionType: 'multiple_choice',\n    questionText: 'How do you currently measure help desk performance?',\n    questionSubtext: null,\n    options: [\n      { value: 'comprehensive', label: 'We have comprehensive KPIs and dashboards', score: 15 },\n      { value: 'basic', label: 'We track basic metrics (response time, resolution time)', score: 10 },\n      { value: 'manual', label: 'We manually pull reports when needed', score: 5 },\n      { value: 'none', label: \"We don't really track metrics\", score: 3 },\n    ],\n    scoringWeight: 1,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 9: Primary Goal\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 9,\n    questionType: 'multiple_choice',\n    questionText: \"What's your PRIMARY goal for improving your help desk?\",\n    questionSubtext: null,\n    options: [\n      { value: 'reduce_costs', label: 'Reduce operational costs', score: 15 },\n      { value: 'improve_satisfaction', label: 'Improve employee satisfaction', score: 12 },\n      { value: 'faster_resolution', label: 'Faster issue resolution', score: 15 },\n      { value: 'prevent_issues', label: 'Prevent recurring problems', score: 18 },\n      { value: 'better_visibility', label: 'Better visibility into IT operations', score: 18 },\n      { value: 'strategic_insights', label: 'Use data for strategic decisions', score: 20 },\n    ],\n    scoringWeight: 2,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 10: Data Readiness\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 10,\n    questionType: 'multiple_choice',\n    questionText: 'How much historical help desk data do you have available?',\n    questionSubtext: 'DDIP works best with 12-18 months of ticket history',\n    options: [\n      { value: '18_months+', label: '18+ months of data', score: 25 },\n      { value: '12-18_months', label: '12-18 months of data', score: 20 },\n      { value: '6-12_months', label: '6-12 months of data', score: 15 },\n      { value: '3-6_months', label: '3-6 months of data', score: 10 },\n      { value: 'under_3_months', label: 'Under 3 months of data', score: 5 },\n      { value: 'unknown', label: \"I'm not sure\", score: 8 },\n    ],\n    scoringWeight: 3,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 11: Previous Attempts\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 11,\n    questionType: 'multiple_choice',\n    questionText: 'Have you tried to improve your help desk processes before?',\n    questionSubtext: null,\n    options: [\n      { value: 'yes_success', label: 'Yes, with some success', score: 15 },\n      { value: 'yes_failed', label: \"Yes, but it didn't work out\", score: 18 },\n      { value: 'no_resources', label: \"No, we haven't had the resources/expertise\", score: 12 },\n      { value: 'no_priority', label: \"No, it hasn't been a priority\", score: 5 },\n    ],\n    scoringWeight: 1,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 12: Budget Authority\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 12,\n    questionType: 'multiple_choice',\n    questionText: \"What's your role in making decisions about help desk improvements?\",\n    questionSubtext: null,\n    options: [\n      { value: 'final_decision', label: 'I make the final decision', score: 25 },\n      { value: 'strong_influence', label: 'I have strong influence on the decision', score: 20 },\n      { value: 'recommend', label: 'I can recommend, but someone else decides', score: 10 },\n      { value: 'no_authority', label: \"I'm just gathering information\", score: 3 },\n    ],\n    scoringWeight: 3,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 13: Timeline\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 13,\n    questionType: 'multiple_choice',\n    questionText: 'When are you looking to start a help desk improvement project?',\n    questionSubtext: null,\n    options: [\n      { value: 'immediately', label: 'Immediately - this is urgent', score: 30 },\n      { value: '1-3_months', label: 'Within 1-3 months', score: 25 },\n      { value: '3-6_months', label: 'Within 3-6 months', score: 15 },\n      { value: '6-12_months', label: '6-12 months', score: 8 },\n      { value: 'exploring', label: 'Just exploring options', score: 3 },\n    ],\n    scoringWeight: 3,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 14: Budget Range\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 14,\n    questionType: 'multiple_choice',\n    questionText: 'What budget range are you considering for this project?',\n    questionSubtext: null,\n    options: [\n      { value: '50k+', label: '$50,000+', score: 30 },\n      { value: '25-50k', label: '$25,000 - $50,000', score: 25 },\n      { value: '10-25k', label: '$10,000 - $25,000', score: 20 },\n      { value: '5-10k', label: '$5,000 - $10,000', score: 10 },\n      { value: 'under_5k', label: 'Under $5,000', score: 3 },\n      { value: 'unsure', label: 'Not sure yet', score: 12 },\n    ],\n    scoringWeight: 3,\n    isRequired: true,\n    placeholder: null,\n    minSelections: null,\n  },\n\n  // Question 15: Biggest Obstacle\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 15,\n    questionType: 'text',\n    questionText: \"What's the biggest obstacle preventing you from improving your help desk today?\",\n    questionSubtext: null,\n    options: null,\n    scoringWeight: 0,\n    isRequired: false,\n    placeholder: \"e.g., 'We don't know where to start', 'No budget approved yet', 'Too busy firefighting'\",\n    minSelections: null,\n  },\n\n  // Question 16: Cross-Departmental Insights\n  {\n    orgId: DEFAULT_ORG_ID,\n    questionNumber: 16,\n    questionType: 'checkbox',\n    questionText: 'Beyond help desk metrics, what other insights would be valuable?',\n    questionSubtext: 'DDIP can identify cross-departmental improvement opportunities',\n    options: [\n      { value: 'training_gaps', label: 'Employee training gaps', score: 5 },\n      { value: 'software_issues', label: 'Problematic software/systems', score: 5 },\n      { value: 'process_bottlenecks', label: 'Process bottlenecks', score: 5 },\n      { value: 'onboarding_issues', label: 'Onboarding weaknesses', score: 5 },\n      { value: 'vendor_performance', label: 'Vendor performance problems', score: 5 },\n      { value: 'security_risks', label: 'Security/compliance risks', score: 8 },\n    ],\n    scoringWeight: 1,\n    isRequired: false,\n    placeholder: null,\n    minSelections: 0,\n  },\n];\n\nasync function seedQuiz() {\n  console.log('🌱 Seeding Help Desk Assessment Quiz...');\n\n  try {\n    // Delete existing questions for default org\n    const deleted = await db\n      .delete(quizQuestions)\n      .where(eq(quizQuestions.orgId, DEFAULT_ORG_ID));\n    console.log(`🗑️  Cleared ${deleted.rowCount || 0} existing questions`);\n\n    // Insert new questions\n    const inserted = await db.insert(quizQuestions).values(HELP_DESK_QUIZ_QUESTIONS).returning();\n    console.log(`✅ Seeded ${inserted.length} quiz questions`);\n\n    // Calculate max possible score\n    const maxScore = HELP_DESK_QUIZ_QUESTIONS.reduce((total, q) => {\n      if (q.questionType === 'multiple_choice' && q.options) {\n        const maxOptionScore = Math.max(...q.options.map((opt: any) => opt.score || 0));\n        return total + maxOptionScore * q.scoringWeight;\n      } else if (q.questionType === 'checkbox' && q.options) {\n        const totalCheckboxScore = q.options.reduce((sum: number, opt: any) => sum + (opt.score || 0), 0);\n        return total + totalCheckboxScore * q.scoringWeight;\n      }\n      return total;\n    }, 0);\n\n    console.log(`📊 Max possible score: ${maxScore} points`);\n    console.log(`📊 Scoring tiers:`);\n    console.log(`   - COLD (0-39%): 0-${Math.floor(maxScore * 0.39)} points`);\n    console.log(`   - WARM (40-59%): ${Math.floor(maxScore * 0.4)}-${Math.floor(maxScore * 0.59)} points`);\n    console.log(`   - HOT (60-79%): ${Math.floor(maxScore * 0.6)}-${Math.floor(maxScore * 0.79)} points`);\n    console.log(`   - QUALIFIED (80-100%): ${Math.floor(maxScore * 0.8)}-${maxScore} points`);\n\n    console.log('\\n✨ Quiz seeding complete!');\n  } catch (error) {\n    console.error('❌ Error seeding quiz:', error);\n    throw error;\n  }\n}\n\n// Run the seed\nseedQuiz()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(error);\n    process.exit(1);\n  });\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\seed-tenants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\update-timeless-clerk-org.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\db\\update-timeless-logo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\instrumentation-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lead' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Workflow' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { auth } from '@clerk/nextjs/server';\nimport { db } from '@/db';\nimport { leads, workflows, type Lead, type NewLead, type Workflow, type NewWorkflow } from '@/db/schema';\nimport { eq, and, desc } from 'drizzle-orm';\n\n/**\n * Get the current organization context from Clerk\n */\nexport async function getOrgContext() {\n  const { orgId, userId } = await auth();\n\n  if (!orgId) {\n    throw new Error('No organization context. User must be in an organization.');\n  }\n\n  if (!userId) {\n    throw new Error('No user context. User must be authenticated.');\n  }\n\n  return { orgId, userId };\n}\n\n/**\n * Get an organization-scoped database client\n * All queries automatically filter by the current user's organization\n */\nexport async function getOrgDb() {\n  const { orgId, userId } = await getOrgContext();\n\n  return {\n    orgId,\n    userId,\n\n    /**\n     * Lead queries - automatically scoped to current organization\n     */\n    leads: {\n      /**\n       * Find all leads for the current organization\n       */\n      findMany: async () => {\n        return db.query.leads.findMany({\n          where: eq(leads.orgId, orgId),\n          orderBy: [desc(leads.createdAt)],\n        });\n      },\n\n      /**\n       * Find a specific lead by ID (must belong to current org)\n       */\n      findById: async (id: string) => {\n        return db.query.leads.findFirst({\n          where: and(eq(leads.id, id), eq(leads.orgId, orgId)),\n        });\n      },\n\n      /**\n       * Find leads by status\n       */\n      findByStatus: async (status: string) => {\n        return db.query.leads.findMany({\n          where: and(eq(leads.orgId, orgId), eq(leads.status, status)),\n          orderBy: [desc(leads.createdAt)],\n        });\n      },\n\n      /**\n       * Create a new lead (automatically adds orgId and userId)\n       */\n      create: async (data: Omit<NewLead, 'orgId' | 'userId'>) => {\n        return db\n          .insert(leads)\n          .values({\n            ...data,\n            orgId,\n            userId,\n          })\n          .returning();\n      },\n\n      /**\n       * Update a lead (must belong to current org)\n       */\n      update: async (id: string, data: Partial<Omit<NewLead, 'orgId' | 'userId'>>) => {\n        return db\n          .update(leads)\n          .set({\n            ...data,\n            updatedAt: new Date(),\n          })\n          .where(and(eq(leads.id, id), eq(leads.orgId, orgId)))\n          .returning();\n      },\n\n      /**\n       * Delete a lead (must belong to current org)\n       */\n      delete: async (id: string) => {\n        return db\n          .delete(leads)\n          .where(and(eq(leads.id, id), eq(leads.orgId, orgId)))\n          .returning();\n      },\n\n      /**\n       * Count leads by status\n       */\n      countByStatus: async () => {\n        const allLeads = await db.query.leads.findMany({\n          where: eq(leads.orgId, orgId),\n        });\n\n        return {\n          pending: allLeads.filter((l) => l.status === 'pending').length,\n          approved: allLeads.filter((l) => l.status === 'approved').length,\n          rejected: allLeads.filter((l) => l.status === 'rejected').length,\n          total: allLeads.length,\n        };\n      },\n    },\n\n    /**\n     * Workflow queries - automatically scoped to current organization\n     */\n    workflows: {\n      /**\n       * Find all workflows for the current organization\n       */\n      findMany: async () => {\n        return db.query.workflows.findMany({\n          where: eq(workflows.orgId, orgId),\n          orderBy: [desc(workflows.createdAt)],\n        });\n      },\n\n      /**\n       * Find a specific workflow by ID (must belong to current org)\n       */\n      findById: async (id: string) => {\n        return db.query.workflows.findFirst({\n          where: and(eq(workflows.id, id), eq(workflows.orgId, orgId)),\n        });\n      },\n\n      /**\n       * Find workflows by lead ID\n       */\n      findByLeadId: async (leadId: string) => {\n        return db.query.workflows.findMany({\n          where: and(eq(workflows.orgId, orgId), eq(workflows.leadId, leadId)),\n          orderBy: [desc(workflows.createdAt)],\n        });\n      },\n\n      /**\n       * Find workflows by status\n       */\n      findByStatus: async (status: string) => {\n        return db.query.workflows.findMany({\n          where: and(eq(workflows.orgId, orgId), eq(workflows.status, status)),\n          orderBy: [desc(workflows.createdAt)],\n        });\n      },\n\n      /**\n       * Create a new workflow (automatically adds orgId)\n       */\n      create: async (data: Omit<NewWorkflow, 'orgId'>) => {\n        return db\n          .insert(workflows)\n          .values({\n            ...data,\n            orgId,\n          })\n          .returning();\n      },\n\n      /**\n       * Update a workflow (must belong to current org)\n       */\n      update: async (id: string, data: Partial<Omit<NewWorkflow, 'orgId'>>) => {\n        return db\n          .update(workflows)\n          .set(data)\n          .where(and(eq(workflows.id, id), eq(workflows.orgId, orgId)))\n          .returning();\n      },\n\n      /**\n       * Delete a workflow (must belong to current org)\n       */\n      delete: async (id: string) => {\n        return db\n          .delete(workflows)\n          .where(and(eq(workflows.id, id), eq(workflows.orgId, orgId)))\n          .returning();\n      },\n    },\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\exa.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\knowledge-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\quiz-types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[277,280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[277,280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Shared quiz types for client and server components\n */\n\nexport type QuizQuestion = {\n  id: string;\n  questionNumber: number;\n  questionType: 'contact_info' | 'multiple_choice' | 'checkbox' | 'text';\n  questionText: string;\n  questionSubtext?: string | null;\n  options?: any;\n  scoringWeight: number;\n  isRequired: boolean;\n  placeholder?: string | null;\n  minSelections?: number | null;\n};\n\nexport type ContactInfo = {\n  email?: string;\n  full_name?: string;\n  company?: string;\n  phone?: string;\n  [key: string]: string | undefined;\n};\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\scoring.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[209,212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[209,212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Scoring algorithm for Help Desk Assessment Quiz\n * Calculates readiness score and determines lead tier\n */\n\nexport interface QuizResponseData {\n  questionId: string;\n  questionNumber: number;\n  answer: any;\n  pointsEarned: number;\n}\n\nexport interface ScoringResult {\n  totalPoints: number;\n  maxPossiblePoints: number;\n  readinessScore: number; // 0-100 percentage\n  tier: 'cold' | 'warm' | 'hot' | 'qualified';\n  breakdown: {\n    contactInfo: number;\n    currentState: number;\n    goals: number;\n    readiness: number;\n  };\n}\n\n/**\n * Max possible score from seed data: 699 points\n * Scoring tiers:\n * - COLD (0-39%): 0-272 points\n * - WARM (40-59%): 279-412 points\n * - HOT (60-79%): 419-552 points\n * - QUALIFIED (80-100%): 559-699 points\n */\nconst MAX_POSSIBLE_POINTS = 699;\n\nexport function calculateScore(responses: QuizResponseData[]): ScoringResult {\n  // Sum up all points earned\n  const totalPoints = responses.reduce((sum, response) => sum + response.pointsEarned, 0);\n\n  // Calculate percentage score (0-100)\n  const readinessScore = Math.round((totalPoints / MAX_POSSIBLE_POINTS) * 100);\n\n  // Determine tier based on percentage\n  let tier: 'cold' | 'warm' | 'hot' | 'qualified';\n  if (readinessScore >= 80) {\n    tier = 'qualified';\n  } else if (readinessScore >= 60) {\n    tier = 'hot';\n  } else if (readinessScore >= 40) {\n    tier = 'warm';\n  } else {\n    tier = 'cold';\n  }\n\n  // Calculate breakdown by category\n  const breakdown = calculateBreakdown(responses);\n\n  return {\n    totalPoints,\n    maxPossiblePoints: MAX_POSSIBLE_POINTS,\n    readinessScore,\n    tier,\n    breakdown,\n  };\n}\n\nfunction calculateBreakdown(responses: QuizResponseData[]) {\n  // Question categories:\n  // Q1-3: Contact & Company Info (baseline qualification)\n  // Q4-8: Current State Assessment (pain & scale)\n  // Q9-11: Goals & Strategic Fit (sophistication)\n  // Q12-16: Readiness Indicators (buying signals)\n\n  const contactInfo = responses\n    .filter((r) => r.questionNumber >= 1 && r.questionNumber <= 3)\n    .reduce((sum, r) => sum + r.pointsEarned, 0);\n\n  const currentState = responses\n    .filter((r) => r.questionNumber >= 4 && r.questionNumber <= 8)\n    .reduce((sum, r) => sum + r.pointsEarned, 0);\n\n  const goals = responses\n    .filter((r) => r.questionNumber >= 9 && r.questionNumber <= 11)\n    .reduce((sum, r) => sum + r.pointsEarned, 0);\n\n  const readiness = responses\n    .filter((r) => r.questionNumber >= 12 && r.questionNumber <= 16)\n    .reduce((sum, r) => sum + r.pointsEarned, 0);\n\n  return {\n    contactInfo,\n    currentState,\n    goals,\n    readiness,\n  };\n}\n\n/**\n * Extract contact information from quiz responses\n */\nexport function extractContactInfo(responses: QuizResponseData[]) {\n  // Question 1 is contact_info type\n  const contactResponse = responses.find((r) => r.questionNumber === 1);\n\n  if (!contactResponse || typeof contactResponse.answer !== 'object') {\n    return {\n      name: '',\n      email: '',\n      company: '',\n      phone: '',\n      jobTitle: '',\n    };\n  }\n\n  const answer = contactResponse.answer as Record<string, string>;\n\n  return {\n    name: answer.full_name || '',\n    email: answer.email || '',\n    company: answer.company || '',\n    phone: answer.phone || '',\n    jobTitle: answer.job_title || '',\n  };\n}\n\n/**\n * Get human-readable tier description\n */\nexport function getTierDescription(tier: string): string {\n  switch (tier) {\n    case 'qualified':\n      return 'High Priority - Ready to Buy';\n    case 'hot':\n      return 'Strong Fit - Near-Term Opportunity';\n    case 'warm':\n      return 'Potential Fit - Mid-Term Nurture';\n    case 'cold':\n      return 'Early Stage - Long-Term Nurture';\n    default:\n      return 'Unknown';\n  }\n}\n\n/**\n * Determine which action to take based on tier\n */\nexport function getTierAction(tier: string): {\n  action: 'ai_workflow' | 'nurture' | 'manual_review';\n  description: string;\n} {\n  switch (tier) {\n    case 'qualified':\n    case 'hot':\n      return {\n        action: 'ai_workflow',\n        description: 'Trigger AI research workflow and personalized outreach',\n      };\n    case 'warm':\n      return {\n        action: 'nurture',\n        description: 'Add to warm lead nurture sequence',\n      };\n    case 'cold':\n      return {\n        action: 'nurture',\n        description: 'Add to cold lead nurture sequence',\n      };\n    default:\n      return {\n        action: 'manual_review',\n        description: 'Manual review required',\n      };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\services.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'name' is defined but never used. Allowed unused args must match /^_/u.","line":139,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":139,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3652,3655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3652,3655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5501,5504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5501,5504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5913,5916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5913,5916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5924,5927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5924,5927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6345,6348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6345,6348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6798,6801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6798,6801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Experimental_Agent as Agent,\r\n  stepCountIs,\r\n  tool,\r\n  generateObject,\r\n  generateText\r\n} from 'ai';\r\nimport {\r\n  FormSchema,\r\n  QualificationSchema,\r\n  qualificationSchema\r\n} from '@/lib/types';\r\nimport { sendSlackMessageWithButtons } from '@/lib/slack';\r\nimport { z } from 'zod';\r\nimport { exa } from '@/lib/exa';\r\n\r\n/**\r\n * Qualify the lead\r\n */\r\nexport async function qualify(\r\n  lead: FormSchema,\r\n  research: string\r\n): Promise<QualificationSchema> {\r\n  const { object } = await generateObject({\r\n    model: 'openai/gpt-5',\r\n    schema: qualificationSchema,\r\n    prompt: `Qualify the lead and give a reason for the qualification based on the following information: LEAD DATA: ${JSON.stringify(\r\n      lead\r\n    )} and RESEARCH: ${research}`\r\n  });\r\n\r\n  return object;\r\n}\r\n\r\n/**\r\n * Write an email\r\n */\r\nexport async function writeEmail(\r\n  research: string,\r\n  qualification: QualificationSchema\r\n) {\r\n  const { text } = await generateText({\r\n    model: 'openai/gpt-5',\r\n    prompt: `Write an email for a ${\r\n      qualification.category\r\n    } lead based on the following information: ${JSON.stringify(research)}`\r\n  });\r\n\r\n  return text;\r\n}\r\n\r\n/**\r\n * Send the research and qualification to the human for approval in slack\r\n */\r\nexport async function humanFeedback(\r\n  research: string,\r\n  email: string,\r\n  qualification: QualificationSchema,\r\n  workflowId: string\r\n) {\r\n  const message = `*New Lead Qualification*\\n\\n*Email:* ${email}\\n*Category:* ${\r\n    qualification.category\r\n  }\\n*Reason:* ${qualification.reason}\\n\\n*Research:*\\n${research.slice(\r\n    0,\r\n    500\r\n  )}...\\n\\n*Please review and approve or reject this email*`;\r\n\r\n  const slackChannel = process.env.SLACK_CHANNEL_ID || '';\r\n\r\n  return await sendSlackMessageWithButtons(slackChannel, message, workflowId);\r\n}\r\n\r\n/**\r\n * Send an email using Resend\r\n */\r\nexport async function sendEmail(\r\n  to: string,\r\n  subject: string,\r\n  content: string,\r\n  from?: string\r\n) {\r\n  const { Resend } = await import('resend');\r\n  const resend = new Resend(process.env.RESEND_API_KEY);\r\n\r\n  try {\r\n    const { data, error } = await resend.emails.send({\r\n      from: from || 'Lead Agent <onboarding@resend.dev>', // Update with your verified domain\r\n      to: [to],\r\n      subject: subject,\r\n      html: content,\r\n    });\r\n\r\n    if (error) {\r\n      console.error('Error sending email:', error);\r\n      throw error;\r\n    }\r\n\r\n    console.log('Email sent successfully:', data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Failed to send email:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * ------------------------------------------------------------\r\n * Agent & Tools\r\n * ------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * Fetch tool\r\n */\r\nexport const fetchUrl = tool({\r\n  description: 'Return visible text from a public URL as Markdown.',\r\n  inputSchema: z.object({\r\n    url: z.string().describe('Absolute URL, including http:// or https://')\r\n  }),\r\n  execute: async ({ url }) => {\r\n    const result = await exa.getContents(url, {\r\n      text: true\r\n    });\r\n    return result;\r\n  }\r\n});\r\n\r\n/**\r\n * CRM Search tool\r\n */\r\nexport const crmSearch = tool({\r\n  description:\r\n    'Search existing Vercel CRM for opportunities by company name or domain',\r\n  inputSchema: z.object({\r\n    name: z\r\n      .string()\r\n      .describe('The name of the company to search for (e.g. \"Vercel\")')\r\n  }),\r\n  execute: async ({ name }) => {\r\n    // fetch from CRM like Salesforce, Hubspot, or Snowflake, etc.\r\n    return [];\r\n  }\r\n});\r\n\r\n/**\r\n * Tech-stack analysis tool using simple-wappalyzer\r\n */\r\n\r\n// Import simple-wappalyzer\r\nlet simpleWappalyzer: any = null;\r\n\r\nasync function getWappalyzer() {\r\n  if (!simpleWappalyzer) {\r\n    simpleWappalyzer = (await import('simple-wappalyzer')).default;\r\n  }\r\n  return simpleWappalyzer;\r\n}\r\n\r\nexport const techStackAnalysis = tool({\r\n  description: 'Analyze the tech stack of a website domain. Returns detected technologies with categories, versions, and confidence scores.',\r\n  inputSchema: z.object({\r\n    domain: z.string().describe('Domain, e.g. \"vercel.com\" or full URL \"https://vercel.com\"')\r\n  }),\r\n  execute: async ({ domain }) => {\r\n    try {\r\n      // Normalize URL\r\n      const url = domain.startsWith('http') ? domain : `https://${domain}`;\r\n\r\n      // Fetch the website with proper headers\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\r\n        },\r\n        redirect: 'follow',\r\n        signal: AbortSignal.timeout(10000) // 10 second timeout\r\n      });\r\n\r\n      if (!response.ok) {\r\n        return `Failed to fetch ${url}: HTTP ${response.status}`;\r\n      }\r\n\r\n      const html = await response.text();\r\n      const headers = Object.fromEntries(response.headers);\r\n\r\n      // Get wappalyzer function and analyze\r\n      const wappalyzer = await getWappalyzer();\r\n      const result = await wappalyzer({\r\n        url,\r\n        html,\r\n        headers,\r\n        statusCode: response.status\r\n      });\r\n\r\n      // Format results for AI agent consumption\r\n      // Result is an array of technology objects\r\n      if (!result || result.length === 0) {\r\n        return `No technologies detected for ${domain}. The site may use custom-built solutions or technologies not in the detection database.`;\r\n      }\r\n\r\n      // Extract and format technologies\r\n      const technologies = result.map((app: any) => {\r\n        // Get primary category name\r\n        const categoryName = app.categories?.[0]?.name || 'Unknown';\r\n\r\n        return {\r\n          name: app.name,\r\n          category: categoryName,\r\n          version: app.version || 'N/A',\r\n          confidence: app.confidence || 100\r\n        };\r\n      });\r\n\r\n      // Group by category for better readability\r\n      const grouped = technologies.reduce((acc: any, tech: any) => {\r\n        const category = tech.category;\r\n        if (!acc[category]) {\r\n          acc[category] = [];\r\n        }\r\n        acc[category].push(tech);\r\n        return acc;\r\n      }, {});\r\n\r\n      // Format as a readable report\r\n      let report = `Tech Stack Analysis for ${domain}:\\n\\n`;\r\n\r\n      for (const [category, techs] of Object.entries(grouped)) {\r\n        report += `${category}:\\n`;\r\n        (techs as any[]).forEach(tech => {\r\n          const versionInfo = tech.version !== 'N/A' ? ` (v${tech.version})` : '';\r\n          const confidenceInfo = tech.confidence !== 100 ? ` [${tech.confidence}% confidence]` : '';\r\n          report += `  - ${tech.name}${versionInfo}${confidenceInfo}\\n`;\r\n        });\r\n        report += '\\n';\r\n      }\r\n\r\n      report += `Total technologies detected: ${technologies.length}`;\r\n\r\n      return report;\r\n\r\n    } catch (error: any) {\r\n      console.error('Tech stack analysis error:', error);\r\n\r\n      if (error.name === 'AbortError' || error.name === 'TimeoutError') {\r\n        return `Timeout while analyzing ${domain}. The website may be slow or unreachable.`;\r\n      }\r\n\r\n      if (error.code === 'ENOTFOUND' || error.code === 'ECONNREFUSED') {\r\n        return `Cannot reach ${domain}. The domain may not exist or is not accessible.`;\r\n      }\r\n\r\n      return `Error analyzing ${domain}: ${error.message}`;\r\n    }\r\n  }\r\n});\r\n\r\n/**\r\n * Search tool\r\n */\r\nconst search = tool({\r\n  description: 'Search the web for information',\r\n  inputSchema: z.object({\r\n    keywords: z\r\n      .string()\r\n      .describe(\r\n        'The entity to search for (e.g. \"Apple\") — do not include any Vercel specific keywords'\r\n      ),\r\n    resultCategory: z\r\n      .enum([\r\n        'company',\r\n        'research paper',\r\n        'news',\r\n        'pdf',\r\n        'github',\r\n        'tweet',\r\n        'personal site',\r\n        'linkedin profile',\r\n        'financial report'\r\n      ])\r\n      .describe('The category of the result you are looking for')\r\n  }),\r\n  execute: async ({ keywords, resultCategory }) => {\r\n    /**\r\n     * Deep research using exa.ai\r\n     * Return the results in markdown format\r\n     */\r\n    const result = await exa.searchAndContents(keywords, {\r\n      numResults: 2,\r\n      type: 'keyword',\r\n      category: resultCategory,\r\n      summary: true\r\n    });\r\n    return result;\r\n  }\r\n});\r\n\r\n/**\r\n * Query the knowledge base\r\n */\r\nconst queryKnowledgeBase = tool({\r\n  description: 'Query the organization knowledge base for relevant information using semantic search.',\r\n  inputSchema: z.object({\r\n    query: z.string().describe('The question or topic to search for in the knowledge base'),\r\n    orgId: z.string().describe('The organization ID to search within')\r\n  }),\r\n  execute: async ({ query, orgId }: { query: string; orgId: string }) => {\r\n    const { searchKnowledgeBase } = await import('@/lib/knowledge-base');\r\n\r\n    // Search for top 3 most relevant chunks\r\n    const results = await searchKnowledgeBase(orgId, query, 3);\r\n\r\n    if (results.length === 0) {\r\n      return 'No relevant information found in the knowledge base.';\r\n    }\r\n\r\n    // Format results as context\r\n    const context = results\r\n      .map((result, i) => {\r\n        return `[${i + 1}] From \"${result.title}\" (relevance: ${(result.similarity * 100).toFixed(1)}%)\\n${result.content}`;\r\n      })\r\n      .join('\\n\\n');\r\n\r\n    return `Found ${results.length} relevant knowledge base entries:\\n\\n${context}`;\r\n  }\r\n});\r\n\r\n/**\r\n * Research agent\r\n *\r\n * This agent is used to research the lead and return a comprehensive report\r\n */\r\nexport const researchAgent = new Agent({\r\n  model: 'openai/gpt-5',\r\n  system: `\r\n  You are a researcher to find information about a lead. You are given a lead and you need to find information about the lead.\r\n  \r\n  You can use the tools provided to you to find information about the lead: \r\n  - search: Searches the web for information\r\n  - queryKnowledgeBase: Queries the knowledge base for the given query\r\n  - fetchUrl: Fetches the contents of a public URL\r\n  - crmSearch: Searches the CRM for the given company name\r\n  - techStackAnalysis: Analyzes the tech stack of the given domain\r\n  \r\n  Synthesize the information you find into a comprehensive report.\r\n  `,\r\n  tools: {\r\n    search,\r\n    queryKnowledgeBase,\r\n    fetchUrl,\r\n    crmSearch,\r\n    techStackAnalysis\r\n    // add other tools here\r\n  },\r\n  stopWhen: [stepCountIs(20)] // stop after max 20 steps\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\slack.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\subscriptions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\tenants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\scripts\\migrate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\types\\simple-wappalyzer.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\workflows\\inbound\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"f:\\leads\\lead-agent\\workflows\\inbound\\steps.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
